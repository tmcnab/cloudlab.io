!function(n){n(function(){"use strict";n.support.transition=function(){var r=document.body||document.documentElement,t=r.style,i=t.transition!==undefined||t.WebkitTransition!==undefined||t.MozTransition!==undefined||t.MsTransition!==undefined||t.OTransition!==undefined;return i&&{end:function(){var t="TransitionEnd";return n.browser.webkit?t="webkitTransitionEnd":n.browser.mozilla?t="transitionend":n.browser.opera&&(t="oTransitionEnd"),t}()}}()})}(window.jQuery),!function(n){"use strict";var i='[data-dismiss="alert"]',t=function(t){n(t).on("click",i,this.close)};t.prototype={constructor:t,close:function(t){function f(){i.remove(),i.trigger("closed")}var u=n(this),r=u.attr("data-target"),i;r||(r=u.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=n(r),i.trigger("close"),t&&t.preventDefault(),i.length||(i=u.hasClass("alert")?u:u.parent()),i.removeClass("in"),n.support.transition&&i.hasClass("fade")?i.on(n.support.transition.end,f):f()}},n.fn.alert=function(i){return this.each(function(){var u=n(this),r=u.data("alert");r||u.data("alert",r=new t(this)),typeof i=="string"&&r[i].call(u)})},n.fn.alert.Constructor=t,n(function(){n("body").on("click.alert.data-api",i,t.prototype.close)})}(window.jQuery),!function(n){"use strict";var t=function(t,i){this.$element=n(t),this.options=n.extend({},n.fn.button.defaults,i)};t.prototype={constructor:t,setState:function(n){var i="disabled",t=this.$element,u=t.data(),r=t.is("input")?"val":"html";n=n+"Text",u.resetText||t.data("resetText",t[r]()),t[r](u[n]||this.options[n]),setTimeout(function(){n=="loadingText"?t.addClass(i).attr(i,i):t.removeClass(i).removeAttr(i)},0)},toggle:function(){var n=this.$element.parent('[data-toggle="buttons-radio"]');n&&n.find(".active").removeClass("active"),this.$element.toggleClass("active")}},n.fn.button=function(i){return this.each(function(){var u=n(this),r=u.data("button"),f=typeof i=="object"&&i;r||u.data("button",r=new t(this,f)),i=="toggle"?r.toggle():i&&r.setState(i)})},n.fn.button.defaults={loadingText:"loading..."},n.fn.button.Constructor=t,n(function(){n("body").on("click.button.data-api","[data-toggle^=button]",function(t){n(t.target).button("toggle")})})}(window.jQuery),!function(n){"use strict";var t=function(t,i){this.$element=n(t),this.options=n.extend({},n.fn.carousel.defaults,i),this.options.slide&&this.slide(this.options.slide)};t.prototype={cycle:function(){return this.interval=setInterval(n.proxy(this.next,this),this.options.interval),this},to:function(t){var u=this.$element.find(".active"),i=u.parent().children(),r=i.index(u),f=this;if(!(t>i.length-1)&&!(t<0))return this.sliding?this.$element.one("slid",function(){f.to(t)}):r==t?this.pause().cycle():this.slide(t>r?"next":"prev",n(i[t]))},pause:function(){return clearInterval(this.interval),this},next:function(){if(!this.sliding)return this.slide("next")},prev:function(){if(!this.sliding)return this.slide("prev")},slide:function(t,i){var f=this.$element.find(".active"),r=i||f[t](),o=this.interval,u=t=="next"?"left":"right",s=t=="next"?"first":"last",e=this;if(this.sliding=!0,o&&this.pause(),r=r.length?r:this.$element.find(".item")[s](),!n.support.transition&&this.$element.hasClass("slide"))this.$element.trigger("slide"),f.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger("slid");else{r.addClass(t),r[0].offsetWidth,f.addClass(u),r.addClass(u),this.$element.trigger("slide");this.$element.one(n.support.transition.end,function(){r.removeClass([t,u].join(" ")).addClass("active"),f.removeClass(["active",u].join(" ")),e.sliding=!1,setTimeout(function(){e.$element.trigger("slid")},0)})}return o&&this.cycle(),this}},n.fn.carousel=function(i){return this.each(function(){var f=n(this),r=f.data("carousel"),u=typeof i=="object"&&i;r||f.data("carousel",r=new t(this,u)),typeof i=="number"?r.to(i):typeof i=="string"||(i=u.slide)?r[i]():r.cycle()})},n.fn.carousel.defaults={interval:5e3},n.fn.carousel.Constructor=t,n(function(){n("body").on("click.carousel.data-api","[data-slide]",function(t){var r=n(this),u,i=n(r.attr("data-target")||(u=r.attr("href"))&&u.replace(/.*(?=#[^\s]+$)/,"")),f=!i.data("modal")&&n.extend({},i.data(),r.data());i.carousel(f),t.preventDefault()})})}(window.jQuery),!function(n){"use strict";var t=function(t,i){this.$element=n(t),this.options=n.extend({},n.fn.collapse.defaults,i),this.options.parent&&(this.$parent=n(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var n=this.$element.hasClass("width");return n?"width":"height"},show:function(){var i=this.dimension(),u=n.camelCase(["scroll",i].join("-")),t=this.$parent&&this.$parent.find(".in"),r;t&&t.length&&(r=t.data("collapse"),t.collapse("hide"),r||t.data("collapse",null)),this.$element[i](0),this.transition("addClass","show","shown"),this.$element[i](this.$element[0][u])},hide:function(){var n=this.dimension();this.reset(this.$element[n]()),this.transition("removeClass","hide","hidden"),this.$element[n](0)},reset:function(n){var t=this.dimension();this.$element.removeClass("collapse")[t](n||"auto")[0].offsetWidth,this.$element.addClass("collapse")},transition:function(t,i,r){var f=this,u=function(){i=="show"&&f.reset(),f.$element.trigger(r)};this.$element.trigger(i)[t]("in"),n.support.transition&&this.$element.hasClass("collapse")?this.$element.one(n.support.transition.end,u):u()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}},n.fn.collapse=function(i){return this.each(function(){var u=n(this),r=u.data("collapse"),f=typeof i=="object"&&i;r||u.data("collapse",r=new t(this,f)),typeof i=="string"&&r[i]()})},n.fn.collapse.defaults={toggle:!0},n.fn.collapse.Constructor=t,n(function(){n("body").on("click.collapse.data-api","[data-toggle=collapse]",function(t){var i=n(this),u,r=i.attr("data-target")||t.preventDefault()||(u=i.attr("href"))&&u.replace(/.*(?=#[^\s]+$)/,""),f=n(r).data("collapse")?"toggle":i.data();n(r).collapse(f)})})}(window.jQuery),!function(n){"use strict";function i(){n(r).parent().removeClass("open")}var r='[data-toggle="dropdown"]',t=function(t){var i=n(t).on("click.dropdown.data-api",this.toggle);n("html").on("click.dropdown.data-api",function(){i.parent().removeClass("open")})};t.prototype={constructor:t,toggle:function(){var f=n(this),r=f.attr("data-target"),u,e;return r||(r=f.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),u=n(r),u.length||(u=f.parent()),e=u.hasClass("open"),i(),!e&&u.toggleClass("open"),!1}},n.fn.dropdown=function(i){return this.each(function(){var u=n(this),r=u.data("dropdown");r||u.data("dropdown",r=new t(this)),typeof i=="string"&&r[i].call(u)})},n.fn.dropdown.Constructor=t,n(function(){n("html").on("click.dropdown.data-api",i);n("body").on("click.dropdown.data-api",r,t.prototype.toggle)})}(window.jQuery),!function(n){"use strict";function e(){var t=this,r=setTimeout(function(){t.$element.off(n.support.transition.end),i.call(t)},500);this.$element.one(n.support.transition.end,function(){clearTimeout(r),i.call(t)})}function i(){this.$element.hide().trigger("hidden"),f.call(this)}function f(t){var f=this,u=this.$element.hasClass("fade")?"fade":"",i;this.isShown&&this.options.backdrop?(i=n.support.transition&&u,this.$backdrop=n('<div class="modal-backdrop '+u+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(n.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),i?this.$backdrop.one(n.support.transition.end,t):t()):!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),n.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(n.support.transition.end,n.proxy(r,this)):r.call(this)):t&&t()}function r(){this.$backdrop.remove(),this.$backdrop=null}function u(){var t=this;if(this.isShown&&this.options.keyboard)n(document).on("keyup.dismiss.modal",function(n){n.which==27&&t.hide()});else this.isShown||n(document).off("keyup.dismiss.modal")}var t=function(t,i){this.options=n.extend({},n.fn.modal.defaults,i),this.$element=n(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",n.proxy(this.hide,this))};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this;this.isShown||(n("body").addClass("modal-open"),this.isShown=!0,this.$element.trigger("show"),u.call(this),f.call(this,function(){var i=n.support.transition&&t.$element.hasClass("fade");!t.$element.parent().length&&t.$element.appendTo(document.body),t.$element.show(),i&&t.$element[0].offsetWidth,t.$element.addClass("in"),i?t.$element.one(n.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")}))},hide:function(t){if(t&&t.preventDefault(),this.isShown){var r=this;this.isShown=!1,n("body").removeClass("modal-open"),u.call(this),this.$element.trigger("hide").removeClass("in"),n.support.transition&&this.$element.hasClass("fade")?e.call(this):i.call(this)}}},n.fn.modal=function(i){return this.each(function(){var u=n(this),r=u.data("modal"),f=typeof i=="object"&&i;r||u.data("modal",r=new t(this,f)),typeof i=="string"?r[i]():r.show()})},n.fn.modal.defaults={backdrop:!0,keyboard:!0},n.fn.modal.Constructor=t,n(function(){n("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var r=n(this),u,i=n(r.attr("data-target")||(u=r.attr("href"))&&u.replace(/.*(?=#[^\s]+$)/,"")),f=i.data("modal")?"toggle":n.extend({},i.data(),r.data());t.preventDefault(),i.modal(f)})})}(window.jQuery),!function(n){"use strict";var t=function(n,t){this.init("tooltip",n,t)};t.prototype={constructor:t,init:function(t,i,r){var f,u;if(this.type=t,this.$element=n(i),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger!="manual"){f=this.options.trigger=="hover"?"mouseenter":"focus",u=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(f,this.options.selector,n.proxy(this.enter,this));this.$element.on(u,this.options.selector,n.proxy(this.leave,this))}this.options.selector?this._options=n.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=n.extend({},n.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var i=n(t.currentTarget)[this.type](this._options).data(this.type);i.options.delay&&i.options.delay.show?(i.hoverState="in",setTimeout(function(){i.hoverState=="in"&&i.show()},i.options.delay.show)):i.show()},leave:function(t){var i=n(t.currentTarget)[this.type](this._options).data(this.type);i.options.delay&&i.options.delay.hide?(i.hoverState="out",setTimeout(function(){i.hoverState=="out"&&i.hide()},i.options.delay.hide)):i.hide()},show:function(){var t,f,n,u,e,i,r;if(this.hasContent()&&this.enabled){t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),i=typeof this.options.placement=="function"?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,f=/in/.test(i),t.remove().css({top:0,left:0,display:"block"}).appendTo(f?this.$element:document.body),n=this.getPosition(f),u=t[0].offsetWidth,e=t[0].offsetHeight;switch(f?i.split(" ")[1]:i){case"bottom":r={top:n.top+n.height,left:n.left+n.width/2-u/2};break;case"top":r={top:n.top-e,left:n.left+n.width/2-u/2};break;case"left":r={top:n.top+n.height/2-e/2,left:n.left-u};break;case"right":r={top:n.top+n.height/2-e/2,left:n.left+n.width}}t.css(r).addClass(i).addClass("in")}},setContent:function(){var n=this.tip();n.find(".tooltip-inner").html(this.getTitle()),n.removeClass("fade in top bottom left right")},hide:function(){function i(){var i=setTimeout(function(){t.off(n.support.transition.end).remove()},500);t.one(n.support.transition.end,function(){clearTimeout(i),t.remove()})}var r=this,t=this.tip();t.removeClass("in"),n.support.transition&&this.$tip.hasClass("fade")?i():t.remove()},fixTitle:function(){var n=this.$element;(n.attr("title")||typeof n.attr("data-original-title")!="string")&&n.attr("data-original-title",n.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return n.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var n,i=this.$element,t=this.options;return n=i.attr("data-original-title")||(typeof t.title=="function"?t.title.call(i[0]):t.title),n=n.toString().replace(/(^\s*|\s*$)/,"")},tip:function(){return this.$tip=this.$tip||n(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}},n.fn.tooltip=function(i){return this.each(function(){var u=n(this),r=u.data("tooltip"),f=typeof i=="object"&&i;r||u.data("tooltip",r=new t(this,f)),typeof i=="string"&&r[i]()})},n.fn.tooltip.Constructor=t,n.fn.tooltip.defaults={animation:!0,delay:0,selector:!1,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery),!function(n){"use strict";var t=function(n,t){this.init("popover",n,t)};t.prototype=n.extend({},n.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var t=this.tip(),r=this.getTitle(),i=this.getContent();t.find(".popover-title")[n.type(r)=="object"?"append":"html"](r),t.find(".popover-content > *")[n.type(i)=="object"?"append":"html"](i),t.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var n,i=this.$element,t=this.options;return n=i.attr("data-content")||(typeof t.content=="function"?t.content.call(i[0]):t.content),n=n.toString().replace(/(^\s*|\s*$)/,"")},tip:function(){return this.$tip||(this.$tip=n(this.options.template)),this.$tip}}),n.fn.popover=function(i){return this.each(function(){var u=n(this),r=u.data("popover"),f=typeof i=="object"&&i;r||u.data("popover",r=new t(this,f)),typeof i=="string"&&r[i]()})},n.fn.popover.Constructor=t,n.fn.popover.defaults=n.extend({},n.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),!function(n){"use strict";function t(t,i){var u=n.proxy(this.process,this),f=n(t).is("body")?n(window):n(t),r;this.options=n.extend({},n.fn.scrollspy.defaults,i),this.$scrollElement=f.on("scroll.scroll.data-api",u),this.selector=(this.options.target||(r=n(t).attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=n("body").on("click.scroll.data-api",this.selector,u),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){this.targets=this.$body.find(this.selector).map(function(){var t=n(this).attr("href");return/^#\w/.test(t)&&n(t).length?t:null}),this.offsets=n.map(this.targets,function(t){return n(t).position().top})},process:function(){for(var i=this.$scrollElement.scrollTop()+this.options.offset,t=this.offsets,r=this.targets,u=this.activeTarget,n=t.length;n--;)u!=r[n]&&i>=t[n]&&(!t[n+1]||i<=t[n+1])&&this.activate(r[n])},activate:function(n){var t;this.activeTarget=n,this.$body.find(this.selector).parent(".active").removeClass("active"),t=this.$body.find(this.selector+'[href="'+n+'"]').parent("li").addClass("active"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active")}},n.fn.scrollspy=function(i){return this.each(function(){var u=n(this),r=u.data("scrollspy"),f=typeof i=="object"&&i;r||u.data("scrollspy",r=new t(this,f)),typeof i=="string"&&r[i]()})},n.fn.scrollspy.Constructor=t,n.fn.scrollspy.defaults={offset:10},n(function(){n('[data-spy="scroll"]').each(function(){var t=n(this);t.scrollspy(t.data())})})}(window.jQuery),!function(n){"use strict";var t=function(t){this.element=n(t)};t.prototype={constructor:t,show:function(){var t=this.element,f=t.closest("ul:not(.dropdown-menu)"),i=t.attr("data-target"),u,r;(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),t.parent("li").hasClass("active"))||(u=f.find(".active a").last()[0],t.trigger({type:"show",relatedTarget:u}),r=n(i),this.activate(t.parent("li"),f),this.activate(r,r.parent(),function(){t.trigger({type:"shown",relatedTarget:u})}))},activate:function(t,i,r){function f(){u.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),e?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var u=i.find("> .active"),e=r&&n.support.transition&&u.hasClass("fade");e?u.one(n.support.transition.end,f):f(),u.removeClass("in")}},n.fn.tab=function(i){return this.each(function(){var u=n(this),r=u.data("tab");r||u.data("tab",r=new t(this)),typeof i=="string"&&r[i]()})},n.fn.tab.Constructor=t,n(function(){n("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),n(this).tab("show")})})}(window.jQuery),!function(n){"use strict";var t=function(t,i){this.$element=n(t),this.options=n.extend({},n.fn.typeahead.defaults,i),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.$menu=n(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var n=this.$menu.find(".active").attr("data-value");return this.$element.val(n),this.hide()},show:function(){var t=n.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var r=this,i,u;return(this.query=this.$element.val(),!this.query)?this.shown?this.hide():this:(i=n.grep(this.source,function(n){if(r.matcher(n))return n}),i=this.sorter(i),!i.length)?this.shown?this.hide():this:this.render(i.slice(0,this.options.items)).show()},matcher:function(n){return~n.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(n){for(var u=[],i=[],r=[],t;t=n.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?i.push(t):r.push(t):u.push(t);return u.concat(i,r)},highlighter:function(n){return n.replace(new RegExp("("+this.query+")","ig"),function(n,t){return"<strong>"+t+"</strong>"})},render:function(t){var i=this;return t=n(t).map(function(t,r){return t=n(i.options.item).attr("data-value",r),t.find("a").html(i.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(){var r=this.$menu.find(".active").removeClass("active"),i=r.next();i.length||(i=n(this.$menu.find("li")[0])),i.addClass("active")},prev:function(){var i=this.$menu.find(".active").removeClass("active"),t=i.prev();t.length||(t=this.$menu.find("li").last()),t.addClass("active")},listen:function(){this.$element.on("blur",n.proxy(this.blur,this)).on("keypress",n.proxy(this.keypress,this)).on("keyup",n.proxy(this.keyup,this));if(n.browser.webkit||n.browser.msie)this.$element.on("keydown",n.proxy(this.keypress,this));this.$menu.on("click",n.proxy(this.click,this)).on("mouseenter","li",n.proxy(this.mouseenter,this))},keyup:function(n){n.stopPropagation(),n.preventDefault();switch(n.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:this.hide();break;default:this.lookup()}},keypress:function(n){if(n.stopPropagation(),this.shown)switch(n.keyCode){case 9:case 13:case 27:n.preventDefault();break;case 38:n.preventDefault(),this.prev();break;case 40:n.preventDefault(),this.next()}},blur:function(n){var t=this;n.stopPropagation(),n.preventDefault(),setTimeout(function(){t.hide()},150)},click:function(n){n.stopPropagation(),n.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),n(t.currentTarget).addClass("active")}},n.fn.typeahead=function(i){return this.each(function(){var u=n(this),r=u.data("typeahead"),f=typeof i=="object"&&i;r||u.data("typeahead",r=new t(this,f)),typeof i=="string"&&r[i]()})},n.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>'},n.fn.typeahead.Constructor=t,n(function(){n("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var i=n(this);i.data("typeahead")||(t.preventDefault(),i.typeahead(i.data()))})})}(window.jQuery);var MarkdownDeep=new function(){function ut(n,t){if(n.indexOf!==undefined)return n.indexOf(t);for(var i=0;i<n.length;i++)if(n[i]===t)return i;return-1}function l(){this.m_SpanFormatter=new ri(this),this.m_SpareBlocks=[],this.m_StringBuilder=new v,this.m_StringBuilderFinal=new v}function fu(n,t,i,r){return n.slice(0,t).concat(r).concat(n.slice(t+i))}function fi(n){return n>="0"&&n<="9"}function eu(n){return n>="0"&&n<="9"||n>="a"&&n<="f"||n>="A"&&n<="F"}function br(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"}function d(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9"}function f(n){return n==" "||n=="\t"||n=="\r"||n=="\n"}function at(n){return n==" "||n=="\t"}function ii(n){return n=="\r"||n=="\n"}function ti(n){return n=="*"||n=="_"}function ei(n,t){switch(n){case"\\":case"`":case"*":case"_":case"{":case"}":case"[":case"]":case"(":case")":case">":case"#":case"+":case"-":case".":case"!":return!0;case":":case"|":case"=":case"<":return t}return!1}function ui(n,t){var r,i;if(n.charAt(t)!="&")return-1;if(r=t,t++,n.charAt(t)=="#"?(t++,n.charAt(t)=="x"||n.charAt(t)=="X"?(t++,i=eu):i=fi):i=d,i(n.charAt(t))){for(t++;i(n.charAt(t));)t++;if(n.charAt(t)==";")return t++,t}return t=r,-1}function tt(n,t){var r=n.indexOf("\\"),u,i;if(r<0)return n;for(u=new v,i=0;r>=0;)ei(n.charAt(r+1),t)&&(r>i&&u.Append(n.substr(i,r-i)),i=r+1),r=n.indexOf("\\",r+1);return i<n.length&&u.Append(n.substr(i,n.length-i)),u.ToString()}function p(n){for(var t=0,i=n.length;t<i&&f(n.charAt(t));)t++;while(i-1>t&&f(n.charAt(i-1)))i--;return n.substr(t,i-t)}function su(n){var i=n.indexOf("@"),t;return i<0?!1:(t=n.lastIndexOf("."),t<i)?!1:!0}function cu(n){return(n=n.toLowerCase(),n.substr(0,7)=="http://")?!0:n.substr(0,8)=="https://"?!0:n.substr(0,6)=="ftp://"?!0:n.substr(0,7)=="file://"?!0:!1}function hu(n){var i,t;if(!n||!br(n.charAt(0)))return!1;for(i=0;i<n.length;i++)if(t=n.charAt(i),!d(t)&&t!="_"&&t!="-"&&t!=":"&&t!=".")return!1;return!0}function yr(n,t,i){for(var r=i-1,o,e,u;r>=t&&f(n.charAt(r));)r--;if(r<t||n.charAt(r)!="}")return null;for(o=r,r--;r>=t&&n.charAt(r)!="{";)r--;if(r<t||n.charAt(r+1)!="#"||(e=r+2,u=n.substr(e,o-e),!hu(u)))return null;while(r>t&&f(n.charAt(r-1)))r--;return{id:u,end:r}}function pr(n,t){return n.substr(0,t.length)==t}function lu(n,t){return n.substr(-t.length)==t}function gi(n){return n.indexOf("://")>=0||pr(n,"mailto:")}function v(){this.m_content=[]}function yt(){this.reset.apply(this,arguments)}function g(n){this.name=n,this.attributes={},this.flags=0,this.closed=!1,this.closing=!1}function vr(n){return n=n.toLowerCase(),n.substr(0,7)=="http://"||n.substr(0,8)=="https://"||n.substr(0,6)=="ftp://"}function pt(n){var i=n.m_position,t=ku(n);return t!=null?t:(n.m_position=i,null)}function ku(n){var i,u,t,r;if(n.current()!="<")return null;if(n.SkipForward(1),n.SkipString("!--")&&(n.Mark(),n.Find("-->")))return i=new g("!"),i.attributes.content=n.Extract(),i.closed=!0,n.SkipForward(3),i;if(u=n.SkipChar("/"),n.Mark(),!n.SkipIdentifier())return null;if(t=new g(n.Extract()),t.closing=u,u)return n.current()!=">"?null:(n.SkipForward(1),t);while(!n.eof()){if(n.SkipWhitespace(),n.SkipString("/>"))return t.closed=!0,t;if(n.SkipChar(">"))return t;if((n.Mark(),!n.SkipIdentifier())||(r=n.Extract(),n.SkipWhitespace(),!n.SkipChar("=")))return null;if(n.SkipWhitespace(),n.SkipChar('"')){if(n.Mark(),!n.Find('"'))return null;t.attributes[r]=n.Extract(),n.SkipForward(1)}else{for(n.Mark();!n.eof()&&!f(n.current())&&n.current()!=">"&&n.current()!="/";)n.SkipForward(1);n.eof()||(t.attributes[r]=n.Extract())}}return null}function ht(n,t,i){this.id=n,this.url=t,this.title=i==undefined?null:i}function gu(n,t){var r=n.m_position,i=vu(n,t);return i==null&&(n.m_position=r),i}function vu(n,t){var i,r;return(n.SkipWhitespace(),!n.SkipChar("["))?null:(n.Mark(),!n.Find("]"))?null:(i=n.Extract(),i.length==0)?null:n.SkipString("]:")?(r=or(n,i,t),n.SkipLinespace(),!n.eol())?null:r:null}function or(n,t,i){var r,s,o,u,c,l,e,h;if(n.SkipWhitespace(),n.eol())return null;if(r=new ht(t),n.SkipChar("<")){for(n.Mark();n.current()!=">";){if(n.eof())return null;n.SkipEscapableChar(i)}if(s=n.Extract(),!n.SkipChar(">"))return null;r.url=tt(p(s),i),n.SkipWhitespace()}else{for(n.Mark(),o=1;!n.eol();){if(u=n.current(),f(u))break;if(t==null)if(u=="(")o++;else if(u==")"&&(o--,o==0))break;n.SkipEscapableChar(i)}r.url=tt(p(n.Extract()),i)}if(n.SkipLinespace(),n.current()==")")return r;c=n.eol(),l=n.m_position,n.eol()&&(n.SkipEol(),n.SkipLinespace());switch(n.current()){case"'":case'"':e=n.current();break;case"(":e=")";break;default:return c?(n.m_position=l,r):null}for(n.SkipForward(1),n.Mark();;){if(n.eol())return null;if(n.current()==e){if(e!=")"){if(h=n.m_position,n.SkipForward(1),n.SkipLinespace(),t==null&&n.current()!=")"||t!=null&&!n.eol())continue;n.m_position=h}break}n.SkipEscapableChar(i)}return r.title=tt(n.Extract(),i),n.SkipForward(1),r}function ct(n,t){this.def=n,this.link_text=t}function kr(n,t,i){this.type=n,this.startOffset=t,this.length=i,this.data=null}function ri(n){this.m_Markdown=n,this.m_Scanner=new yt,this.m_SpareTokens=[],this.m_DisableLinks=!1,this.m_Tokens=[]}function ai(){}function b(n,t){this.m_Markdown=n,this.m_parentType=i,this.m_bMarkdownInHtml=t}function kt(){this.m_Columns=[],this.m_Headers=null,this.m_Rows=[]}function uu(n){var t,r,u,i;if(n.SkipLinespace(),n.current()!="|"&&n.current()!=":"&&n.current()!="-")return null;for(t=null,n.SkipChar("|")&&(t=new kt,t.LeadingBar=!0);;){if(n.SkipLinespace(),n.current()=="|")return null;for(r=n.SkipChar(":");n.current()=="-";)n.SkipForward(1);if(u=n.SkipChar(":"),n.SkipLinespace(),i=ou,r&&u?i=ir:r?i=rr:u&&(i=fr),n.eol())return t==null?null:(t.m_Columns.push(i),t);if(!n.SkipChar("|"))return null;if(t==null&&(t=new kt),t.m_Columns.push(i),n.SkipLinespace(),n.eol())return t.TrailingBar=!0,t}}var n;l.prototype={SafeMode:!1,ExtraMode:!1,MarkdownInHtml:!1,AutoHeadingIDs:!1,UrlBaseLocation:null,UrlRootLocation:null,NewWindowForExternalLinks:!1,NewWindowForLocalLinks:!1,NoFollowLinks:!1,HtmlClassFootnotes:"footnotes",HtmlClassTitledImages:null,RenderingTitledImage:!1,FormatCodeBlockAttributes:null,FormatCodeBlock:null,ExtractHeadBlocks:!1,HeadBlockContent:""},n=l.prototype,l.prototype.GetListItems=function(n,t){for(var u=this.ProcessBlocks(n),r,o,f,s,e,i=0;i<u.length;i++){if(r=u[i],(r.blockType==hi||r.blockType==y||r.blockType==yi)&&r.children){u=fu(u,i,1,r.children),i--;continue}if(t<r.lineStart)break}if((i--,i<0)||(o=u[i],o.blockType!=di&&o.blockType!=pi))return null;for(f=[],s=o.children,e=0;e<s.length;e++)f.push(s[e].lineStart);return i++,i<u.length?f.push(u[i].lineStart):f.push(n.length),f},l.prototype.Transform=function(n){var a=n.indexOf("\r"),h,s,e,c,t,l,u,f,o,i;if(a>=0&&(h=n.indexOf("\n"),h>=0&&(n=h<a?n.replace(/\n\r/g,"\n"):n.replace(/\r\n/g,"\n")),n=n.replace(/\r/g,"\n")),this.HeadBlockContent="",s=this.ProcessBlocks(n),this.m_Abbreviations!=null){e=[];for(c in this.m_Abbreviations)e.push(this.m_Abbreviations[c]);e.sort(function(n,t){return t.Abbr.length-n.Abbr.length}),this.m_Abbreviations=e}for(t=this.m_StringBuilderFinal,t.Clear(),u=0;u<s.length;u++)l=s[u],l.Render(this,t);if(this.m_UsedFootnotes.length>0){for(t.Append('\n<div class="'),t.Append(this.HtmlClassFootnotes),t.Append('">\n'),t.Append("<hr />\n"),t.Append("<ol>\n"),u=0;u<this.m_UsedFootnotes.length;u++)f=this.m_UsedFootnotes[u],t.Append('<li id="#fn:'),t.Append(f.data),t.Append('">\n'),o='<a href="#fnref:'+f.data+'" rev="footnote">&#8617;</a>',i=f.children[f.children.length-1],i.blockType==r?(i.blockType=li,i.data=o):(i=new ai,i.contentLen=0,i.blockType=li,i.data=o,f.children.push(i)),f.Render(this,t),t.Append("</li>\n");t.Append("</ol\n"),t.Append("</div>\n")}return t.ToString()},l.prototype.OnQualifyUrl=function(n){var i,t;if(gi(n))return n;if(pr(n,"/")){if(i=this.UrlRootLocation,!i){if(!this.UrlBaseLocation)return n;t=this.UrlBaseLocation.indexOf("://"),t==-1?t=0:t+=3,t=this.UrlBaseLocation.indexOf("/",t),i=t<0?this.UrlBaseLocation:this.UrlBaseLocation.substr(0,t)}return i+n}return this.UrlBaseLocation?lu(this.UrlBaseLocation,"/")?this.UrlBaseLocation+n:this.UrlBaseLocation+"/"+n:n},l.prototype.OnGetImageSize=function(){return null},l.prototype.OnPrepareLink=function(n){var t=n.attributes.href;this.NoFollowLinks&&(n.attributes.rel="nofollow"),(this.NewWindowForExternalLinks&&gi(t)||this.NewWindowForLocalLinks&&!gi(t))&&(n.attributes.target="_blank"),n.attributes.href=this.OnQualifyUrl(t)},l.prototype.OnPrepareImage=function(n,t){var i=this.OnGetImageSize(n.attributes.src,t);i!=null&&(n.attributes.width=i.width,n.attributes.height=i.height),n.attributes.src=this.OnQualifyUrl(n.attributes.src)},l.prototype.GetLinkDefinition=function(n){var t=this.m_LinkDefinitions[n];return t==undefined?null:t},n.ProcessBlocks=function(n){return this.m_LinkDefinitions=[],this.m_Footnotes=[],this.m_UsedFootnotes=[],this.m_UsedHeaderIDs=[],this.m_Abbreviations=null,new b(this,this.MarkdownInHtml).Process(n)},n.AddLinkDefinition=function(n){this.m_LinkDefinitions[n.id]=n},n.AddFootnote=function(n){this.m_Footnotes[n.data]=n},n.ClaimFootnote=function(n){var t=this.m_Footnotes[n];return t!=undefined?(this.m_UsedFootnotes.push(t),delete this.m_Footnotes[n],this.m_UsedFootnotes.length-1):-1},n.AddAbbreviation=function(n,t){this.m_Abbreviations==null&&(this.m_Abbreviations=[]),this.m_Abbreviations[n]={Abbr:n,Title:t}},n.GetAbbreviations=function(){return this.m_Abbreviations},n.MakeUniqueHeaderID=function(n,t,i){var u,r,f;if(!this.AutoHeadingIDs)return null;for(u=this.m_SpanFormatter.MakeID(n,t,i),u||(u="section"),r=u,f=1;this.m_UsedHeaderIDs[r]!=undefined;)r=u+"-"+f.toString(),f++;return this.m_UsedHeaderIDs[r]=!0,r},n.GetStringBuilder=function(){return this.m_StringBuilder.Clear(),this.m_StringBuilder},n=v.prototype,n.Append=function(n){n&&this.m_content.push(n)},n.Clear=function(){this.m_content.length=0},n.ToString=function(){return this.m_content.join("")},n.HtmlRandomize=function(n){for(var r=n.length,i,t=0;t<r;t++)i=Math.random(),i>.9&&n.charAt(t)!="@"?this.Append(n.charAt(t)):i>.45?(this.Append("&#"),this.Append(n.charCodeAt(t).toString()),this.Append(";")):(this.Append("&#x"),this.Append(n.charCodeAt(t).toString(16)),this.Append(";"))},n.HtmlEncode=function(n,t,i){for(var f=t+i,r=t,u=t;u<f;u++)switch(n.charAt(u)){case"&":u>r&&this.Append(n.substr(r,u-r)),this.Append("&amp;"),r=u+1;break;case"<":u>r&&this.Append(n.substr(r,u-r)),this.Append("&lt;"),r=u+1;break;case">":u>r&&this.Append(n.substr(r,u-r)),this.Append("&gt;"),r=u+1;break;case'"':u>r&&this.Append(n.substr(r,u-r)),this.Append("&quot;"),r=u+1}u>r&&this.Append(n.substr(r,u-r))},n.SmartHtmlEncodeAmpsAndAngles=function(n,t,i){for(var e=t+i,u=t,f,r=t;r<e;r++)switch(n.charAt(r)){case"&":f=ui(n,r),f<0?(r>u&&this.Append(n.substr(u,r-u)),this.Append("&amp;"),u=r+1):r=f-1;break;case"<":r>u&&this.Append(n.substr(u,r-u)),this.Append("&lt;"),u=r+1;break;case">":r>u&&this.Append(n.substr(u,r-u)),this.Append("&gt;"),u=r+1;break;case'"':r>u&&this.Append(n.substr(u,r-u)),this.Append("&quot;"),u=r+1}r>u&&this.Append(n.substr(u,r-u))},n.SmartHtmlEncodeAmps=function(n,t,i){for(var e=t+i,u=t,f,r=t;r<e;r++)switch(n.charAt(r)){case"&":f=ui(n,r),f<0?(r>u&&this.Append(n.substr(u,r-u)),this.Append("&amp;"),u=r+1):r=f-1}r>u&&this.Append(n.substr(u,r-u))},n.HtmlEncodeAndConvertTabsToSpaces=function(n,t,i){for(var e=t+i,r=t,f=0,u=t;u<e;u++){switch(n.charAt(u)){case"\t":for(u>r&&this.Append(n.substr(r,u-r)),r=u+1,this.Append(" "),f++;f%4!=0;)this.Append(" "),f++;f--;break;case"\r":case"\n":u>r&&this.Append(n.substr(r,u-r)),this.Append("\n"),r=u+1;continue;case"&":u>r&&this.Append(n.substr(r,u-r)),this.Append("&amp;"),r=u+1;break;case"<":u>r&&this.Append(n.substr(r,u-r)),this.Append("&lt;"),r=u+1;break;case">":u>r&&this.Append(n.substr(r,u-r)),this.Append("&gt;"),r=u+1;break;case'"':u>r&&this.Append(n.substr(r,u-r)),this.Append("&quot;"),r=u+1}f++}u>r&&this.Append(n.substr(r,u-r))},n=yt.prototype,n.bof=function(){return this.m_position==this.start},n.eof=function(){return this.m_position>=this.end},n.eol=function(){if(this.m_position>=this.end)return!0;var n=this.buf.charAt(this.m_position);return n=="\r"||n=="\n"||n==undefined||n==""},n.reset=function(){this.buf=arguments.length>0?arguments[0]:null,this.start=arguments.length>1?arguments[1]:0,this.end=arguments.length>2?this.start+arguments[2]:this.buf==null?0:this.buf.length,this.m_position=this.start,this.charset_offsets={}},n.current=function(){return this.m_position>=this.end?"\x00":this.buf.charAt(this.m_position)},n.remainder=function(){return this.buf.substr(this.m_position)},n.SkipToEof=function(){this.m_position=this.end},n.SkipForward=function(n){this.m_position+=n},n.SkipToEol=function(){this.m_position=this.buf.indexOf("\n",this.m_position),this.m_position<0&&(this.m_position=this.end)},n.SkipEol=function(){var n=this.m_position;return this.buf.charAt(this.m_position)=="\r"&&this.m_position++,this.buf.charAt(this.m_position)=="\n"&&this.m_position++,this.m_position!=n},n.SkipToNextLine=function(){this.SkipToEol(),this.SkipEol()},n.CharAtOffset=function(n){return this.m_position+n>=this.end?"\x00":this.buf.charAt(this.m_position+n)},n.SkipChar=function(n){return this.buf.charAt(this.m_position)==n?(this.m_position++,!0):!1},n.SkipString=function(n){return this.buf.substr(this.m_position,n.length)==n?(this.m_position+=n.length,!0):!1},n.SkipWhitespace=function(){for(var t=this.m_position,n;;){if(n=this.buf.charAt(this.m_position),n!=" "&&n!="\t"&&n!="\r"&&n!="\n")break;this.m_position++}return this.m_position!=t},n.SkipLinespace=function(){for(var t=this.m_position,n;;){if(n=this.buf.charAt(this.m_position),n!=" "&&n!="\t")break;this.m_position++}return this.m_position!=t},n.FindRE=function(n){n.lastIndex=this.m_position;var t=n.exec(this.buf);return t==null?(this.m_position=this.end,!1):t.index+t[0].length>this.end?(this.m_position=this.end,!1):(this.m_position=t.index,!0)},n.FindOneOf=function(t){var r=-1,u,i;for(u in t)i=t[u],i==null&&(i={},i.m_searched_from=-1,i.m_found_at=-1,t[u]=i),(i.m_searched_from==-1||this.m_position<i.m_searched_from||this.m_position>=i.m_found_at&&i.m_found_at!=-1)&&(i.m_searched_from=this.m_position,i.m_found_at=this.buf.indexOf(u,this.m_position)),(r==-1||i.m_found_at<r)&&(r=i.m_found_at);return r==-1?(r=this.end,!1):(n.m_position=r,!0)},n.Find=function(n){return(this.m_position=this.buf.indexOf(n,this.m_position),this.m_position<0)?(this.m_position=this.end,!1):!0},n.Mark=function(){this.mark=this.m_position},n.Extract=function(){return this.mark>=this.m_position?"":this.buf.substr(this.mark,this.m_position-this.mark)},n.SkipIdentifier=function(){var n=this.buf.charAt(this.m_position);if(n>="a"&&n<="z"||n>="A"&&n<="Z"||n=="_")for(this.m_position++;;)if(n=this.buf.charAt(this.m_position),n>="a"&&n<="z"||n>="A"&&n<="Z"||n=="_"||n>="0"&&n<="9")this.m_position++;else return!0;return!1},n.SkipFootnoteID=function(){var i=this.m_position,n,t;for(this.SkipLinespace(),this.Mark();;)if(n=this.current(),d(n)||n=="-"||n=="_"||n==":"||n=="."||n==" ")this.SkipForward(1);else break;return this.m_position>this.mark&&(t=p(this.Extract()),t.length>0)?(this.SkipLinespace(),t):(this.m_position=i,null)},n.SkipHtmlEntity=function(){if(this.buf.charAt(this.m_position)!="&")return!1;var n=ui(this.buf,this.m_position);return n<0?!1:(this.m_position=n,!0)},n.SkipEscapableChar=function(n){return this.buf.charAt(this.m_position)=="\\"&&ei(this.buf.charAt(this.m_position+1),n)?(this.m_position+=2,!0):(this.m_position<this.end&&this.m_position++,!1)};var cr=1,si=2,ar=4,lr=8;n=g.prototype,n.attributeCount=function(){var n,t;if(!this.attributes)return 0;n=0;for(t in this.attributes)n++;return n},n.get_Flags=function(){return this.flags==0&&(this.flags=nf[this.name.toLowerCase()],this.flags==undefined&&(this.flags=si)),this.flags},n.IsSafe=function(){var i=this.name.toLowerCase(),n,t;if(!bu[i])return!1;if(n=du[i],!n)return this.attributeCount()==0;if(!this.attributes)return!0;for(t in this.attributes)if(!n[t.toLowerCase()])return!1;return this.attributes.href&&!vr(this.attributes.href)?!1:this.attributes.src&&!vr(this.attributes.src)?!1:!0},n.RenderOpening=function(n){n.Append("<"),n.Append(this.name);for(var t in this.attributes)n.Append(" "),n.Append(t),n.Append('="'),n.Append(this.attributes[t]),n.Append('"');this.closed?n.Append(" />"):n.Append(">")},n.RenderClosing=function(n){n.Append("</"),n.Append(this.name),n.Append(">")};var bu={b:1,blockquote:1,code:1,dd:1,dt:1,dl:1,del:1,em:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,kbd:1,li:1,ol:1,ul:1,p:1,pre:1,s:1,sub:1,sup:1,strong:1,strike:1,img:1,a:1},du={a:{href:1,title:1},img:{src:1,width:1,height:1,alt:1,title:1}},t=cr,w=si,vi=ar,e=lr,nf={p:t|e,div:t,h1:t|e,h2:t|e,h3:t|e,h4:t|e,h5:t|e,h6:t|e,blockquote:t,pre:t,table:t,dl:t,ol:t,ul:t,form:t,fieldset:t,iframe:t,script:t|w,noscript:t|w,math:t|w,ins:t|w,del:t|w,img:t|w,li:e,dd:e,dt:e,td:e,th:e,legend:e,address:e,hr:t|vi,"!":t|vi,head:t};delete t,delete w,delete vi,n=ht.prototype,n.RenderLink=function(n,t,i){if(this.url.substr(0,7).toLowerCase()=="mailto:")t.Append('<a href="'),t.HtmlRandomize(this.url),t.Append('"'),this.title&&(t.Append(' title="'),t.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),t.Append('"')),t.Append(">"),t.HtmlRandomize(i),t.Append("</a>");else{var u=new g("a"),r=n.GetStringBuilder();r.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length),u.attributes.href=r.ToString(),this.title&&(r.Clear(),r.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),u.attributes.title=r.ToString()),n.OnPrepareLink(u),u.RenderOpening(t),t.Append(i),t.Append("</a>")}},n.RenderImg=function(n,t,i){var u=new g("img"),r=n.GetStringBuilder();r.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length),u.attributes.src=r.ToString(),i&&(r.Clear(),r.SmartHtmlEncodeAmpsAndAngles(i,0,i.length),u.attributes.alt=r.ToString()),this.title&&(r.Clear(),r.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),u.attributes.title=r.ToString()),u.closed=!0,n.OnPrepareImage(u,n.RenderingTitledImage),u.RenderOpening(t)};var k=0,er=1,wi=2,sr=3,gr=4,hr=5,wr=6,tu=7,nu=8,rt=9,bt=10,et=11,ot=12,it=13,ru=14,iu=15;n=ri.prototype,n.FormatParagraph=function(n,t,i,r){if(this.Tokenize(t,i,r),this.m_Tokens.length==1&&this.m_Markdown.HtmlClassTitledImages!=null&&this.m_Tokens[0].type==bt){var u=this.m_Tokens[0].data;n.Append('<div class="'),n.Append(this.m_Markdown.HtmlClassTitledImages),n.Append('">\n'),this.m_Markdown.RenderingTitledImage=!0,this.Render(n,t),this.m_Markdown.RenderingTitledImage=!1,n.Append("\n"),u.def.title&&(n.Append("<p>"),n.SmartHtmlEncodeAmpsAndAngles(u.def.title,0,u.def.title.length),n.Append("</p>\n")),n.Append("</div>\n")}else n.Append("<p>"),this.Render(n,t),n.Append("</p>\n")},n.Format2=function(n,t){this.Format(n,t,0,t.length)},n.Format=function(n,t,i,r){this.Tokenize(t,i,r),this.Render(n,t)},n.FormatDirect=function(n){var t=new v;return this.Format(t,n,0,n.length),t.ToString()},n.MakeID=function(n,t,i){var s,u,o,e,r,f;for(this.Tokenize(n,t,i),s=this.m_Tokens,u=new v,o=0;o<s.length;o++){e=s[o];switch(e.type){case k:u.Append(n.substr(e.startOffset,e.length));break;case rt:u.Append(e.data.link_text)}this.FreeToken(e)}for(r=this.m_Scanner,r.reset(u.ToString());!r.eof();){if(br(r.current()))break;r.SkipForward(1)}for(u.Clear();!r.eof();){if(f=r.current(),d(f)||f=="_"||f=="-"||f==".")u.Append(f.toLowerCase());else if(f==" ")u.Append("-");else if(ii(f)){u.Append("-"),r.SkipEol();continue}r.SkipForward(1)}return u.ToString()},n.Render=function(n,t){for(var s=this.m_Tokens,h=s.length,i,o,r,f,u,e=0;e<h;e++){i=s[e];switch(i.type){case k:n.HtmlEncode(t,i.startOffset,i.length);break;case er:n.SmartHtmlEncodeAmps(t,i.startOffset,i.length);break;case wi:case et:case ot:case it:n.Append(t.substr(i.startOffset,i.length));break;case nu:n.Append("<br />\n");break;case sr:n.Append("<em>");break;case gr:n.Append("</em>");break;case hr:n.Append("<strong>");break;case wr:n.Append("</strong>");break;case tu:n.Append("<code>"),n.HtmlEncode(t,i.startOffset,i.length),n.Append("</code>");break;case rt:r=i.data,o=new ri(this.m_Markdown),o.m_DisableLinks=!0,r.def.RenderLink(this.m_Markdown,n,o.FormatDirect(r.link_text));break;case bt:r=i.data,r.def.RenderImg(this.m_Markdown,n,r.link_text);break;case ru:f=i.data,n.Append('<sup id="fnref:'),n.Append(f.id),n.Append('"><a href="#fn:'),n.Append(f.id),n.Append('" rel="footnote">'),n.Append(f.index+1),n.Append("</a></sup>");break;case iu:u=i.data,n.Append("<abbr"),u.Title&&(n.Append(' title="'),n.HtmlEncode(u.Title,0,u.Title.length),n.Append('"')),n.Append(">"),n.HtmlEncode(u.Abbr,0,u.Abbr.length),n.Append("</abbr>")}this.FreeToken(i)}},n.Tokenize=function(n,t,i){var r=this.m_Scanner,o,h,u,p,l,f,v,y,a;r.reset(n,t,i),o=this.m_Tokens,o.length=0;for(var s=null,c=this.m_Markdown.GetAbbreviations(),w=c==null?/[\*\_\`\[\!\<\&\ \\]/g:null,b=this.m_Markdown.ExtraMode,e=r.m_position;!r.eof();){if(w!=null&&!r.FindRE(w))break;h=r.m_position,u=null;switch(r.current()){case"*":case"_":if(u=this.CreateEmphasisMark(),u!=null)switch(u.type){case it:case et:case ot:s==null&&(s=[]),s.push(u)}break;case"`":u=this.ProcessCodeSpan();break;case"[":case"!":p=r.m_position,u=this.ProcessLinkOrImageOrFootnote(),u==null&&(r.m_position=p);break;case"<":f=r.m_position,l=pt(r),l!=null?!this.m_Markdown.SafeMode||l.IsSafe()?u=this.CreateToken(er,f,r.m_position-f):r.m_position=f:(r.m_position=f,u=this.ProcessAutoLink(),u==null&&(r.m_position=f));break;case"&":f=r.m_position,r.SkipHtmlEntity()&&(u=this.CreateToken(wi,f,r.m_position-f));break;case" ":r.CharAtOffset(1)==" "&&ii(r.CharAtOffset(2))&&(r.SkipForward(2),r.eof()||(r.SkipEol(),u=this.CreateToken(nu,h,0)));break;case"\\":ei(r.CharAtOffset(1),b)&&(u=this.CreateToken(k,r.m_position+1,1),r.SkipForward(2))}if(u==null&&c!=null&&!d(r.CharAtOffset(-1))){v=r.m_position;for(y in c){if(a=c[y],r.SkipString(a.Abbr)&&!d(r.current())){u=this.CreateDataToken(iu,a);break}r.position=v}}u!=null?(h>e&&o.push(this.CreateToken(k,e,h-e)),o.push(u),e=r.m_position):r.SkipForward(1)}r.m_position>e&&o.push(this.CreateToken(k,e,r.m_position-e)),s!=null&&this.ResolveEmphasisMarks(o,s)},n.CreateEmphasisMark=function(){var n=this.m_Scanner,i=n.current(),o=i=="*"?"_":"*",t=n.m_position,e,r,u;if(n.bof()||f(n.CharAtOffset(-1))){while(ti(n.current()))n.SkipForward(1);if(n.eof()||f(n.current()))return this.CreateToken(wi,t,n.m_position-t);n.m_position=t}while(ti(n.CharAtOffset(-1)))n.SkipForward(-1);for(e=n.bof()||f(n.CharAtOffset(-1)),n.m_position=t;n.current()==i;)n.SkipForward(1);for(r=n.m_position-t;ti(n.CharAtOffset(1));)n.SkipForward(1);return(u=n.eof()||f(n.current()),n.m_position=t+r,e)?this.CreateToken(et,t,n.m_position-t):u?this.CreateToken(ot,t,n.m_position-t):this.m_Markdown.ExtraMode&&i=="_"?null:this.CreateToken(it,t,n.m_position-t)},n.SplitMarkToken=function(n,t,i,r){var u=this.CreateToken(i.type,i.startOffset+r,i.length-r);return i.length=r,t.splice(ut(t,i)+1,0,u),n.splice(ut(n,i)+1,0,u),u},n.ResolveEmphasisMarks=function(n,t){for(var s=this.m_Scanner.buf,o=!0,f,i,e,u,r;o;)for(o=!1,f=0;f<t.length;f++)if(i=t[f],i.type==et||i.type==it)for(e=f+1;e<t.length;e++){if(u=t[e],u.type!=ot&&u.type!=it)break;if(s.charAt(i.startOffset)==s.charAt(u.startOffset)){r=Math.min(i.length,u.length),r>=3&&(r=r%2==1?1:2),i.length>r&&(i=this.SplitMarkToken(n,t,i,i.length-r),f--),u.length>r&&this.SplitMarkToken(n,t,u,r),i.type=r==1?sr:hr,u.type=r==1?gr:wr,t.splice(ut(t,i),1),t.splice(ut(t,u),1),o=!0;break}}},n.ProcessAutoLink=function(){var t,u,e,n,i,r;if(this.m_DisableLinks)return null;for(t=this.m_Scanner,t.SkipForward(1),t.Mark(),u=this.m_Markdown.ExtraMode;!t.eof();){if(e=t.current(),f(e))break;if(e==">")return(n=tt(t.Extract(),u),i=null,su(n)?(n.toLowerCase().substr(0,7)=="mailto:"?r=n.substr(7):(r=n,n="mailto:"+n),i=new ct(new ht("auto",n,null),r)):cu(n)&&(i=new ct(new ht("auto",n,null),n)),i!=null)?(t.SkipForward(1),this.CreateDataToken(rt,i)):null;t.SkipEscapableChar(u)}return null},n.ProcessLinkOrImageOrFootnote=function(){var n=this.m_Scanner,a=n.SkipChar("!")?bt:rt,e,s,l,v,h,p,o,y,t,u,r,i,c;if(!n.SkipChar("["))return null;if(e=this.m_position,this.m_Markdown.ExtraMode&&a==rt&&n.SkipChar("^")){if(n.SkipLinespace(),n.Mark(),s=n.SkipFootnoteID(),s!=null&&n.SkipChar("]")&&(l=this.m_Markdown.ClaimFootnote(s),l>=0))return this.CreateDataToken(ru,{index:l,id:s});this.m_position=e}if(this.m_DisableLinks)return null;for(v=this.m_Markdown.ExtraMode,n.Mark(),h=1;!n.eof();){if(p=n.current(),p=="[")h++;else if(p=="]"&&(h--,h==0))break;n.SkipEscapableChar(v)}if(n.eof())return null;if(o=tt(n.Extract(),v),n.SkipForward(1),e=n.m_position,n.SkipChar("("))return(y=or(n,null,this.m_Markdown.ExtraMode),y==null)?null:(n.SkipWhitespace(),!n.SkipChar(")"))?null:this.CreateDataToken(a,new ct(y,o));if(n.SkipChar(" ")||n.SkipChar("\t"),n.eol()&&(n.SkipEol(),n.SkipLinespace()),t=null,n.current()=="["){if(n.SkipForward(1),n.Mark(),!n.Find("]"))return null;t=n.Extract(),n.SkipForward(1)}else n.m_position=e;if(!t)for(t=o;;){if(u=t.indexOf("\n"),u<0)break;for(r=u;r>0&&f(t.charAt(r-1));)r--;for(i=u;i<t.length&&f(t.charAt(i));)i++;t=t.substr(0,r)+" "+t.substr(i)}return(c=this.m_Markdown.GetLinkDefinition(t),c==null)?null:this.CreateDataToken(a,new ct(c,o))},n.ProcessCodeSpan=function(){for(var n=this.m_Scanner,t=n.m_position,r=0,i,e,u;n.SkipChar("`");)r++;if((n.SkipWhitespace(),n.eof())||(i=n.m_position,!n.Find(n.buf.substr(t,r))))return this.CreateToken(k,t,n.m_position-t);for(e=n.m_position+r;f(n.CharAtOffset(-1));)n.SkipForward(-1);return u=this.CreateToken(tu,i,n.m_position-i),n.m_position=e,u},n.CreateToken=function(n,t,i){if(this.m_SpareTokens.length!=0){var r=this.m_SpareTokens.pop();return r.type=n,r.startOffset=t,r.length=i,r.data=null,r}return new kr(n,t,i)},n.CreateDataToken=function(n,t){var i;return this.m_SpareTokens.length!=0?(i=this.m_SpareTokens.pop(),i.type=n,i.data=t,i):(i=new kr(n,0,0),i.data=t,i)},n.FreeToken=function(n){n.data=null,this.m_SpareTokens.push(n)};var i=0,nt=1,dr=2,au=3,yu=4,wu=5,pu=6,st=7,tr=8,o=9,a=10,c=11,r=12,h=13,wt=14,y=15,lt=16,ci=17,oi=18,ur=19,pi=20,di=21,yi=22,hi=23,bi=24,u=25,ft=26,nr=27,s=28,li=29;n=ai.prototype,n.buf=null,n.blockType=i,n.contentStart=0,n.contentLen=0,n.lineStart=0,n.lineLen=0,n.children=null,n.data=null,n.get_Content=function(){return this.buf==null?null:this.contentStart==-1?this.buf:this.buf.substr(this.contentStart,this.contentLen)},n.get_CodeContent=function(){for(var t=new v,n=0;n<this.children.length;n++)t.Append(this.children[n].get_Content()),t.Append("\n");return t.ToString()},n.RenderChildren=function(n,t){for(var i=0;i<this.children.length;i++)this.children[i].Render(n,t)},n.ResolveHeaderID=function(n){if(this.data!=null)return this.data;var i=yr(this.buf,this.contentStart,this.get_contentEnd()),t=null;return i!=null?(this.set_contentEnd(i.end),t=i.id):t=n.MakeUniqueHeaderID(this.buf,this.contentStart,this.contentLen),this.data=t,t},n.Render=function(n,t){var k,h,l,e,b,w,f,d;switch(this.blockType){case i:return;case r:n.m_SpanFormatter.FormatParagraph(t,this.buf,this.contentStart,this.contentLen);break;case ci:n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen),t.Append("\n");break;case nt:case dr:case au:case yu:case wu:case pu:n.ExtraMode&&!n.SafeMode?(t.Append("<h"+(this.blockType-nt+1).toString()),k=this.ResolveHeaderID(n),k?(t.Append(' id="'),t.Append(k),t.Append('">')):t.Append(">")):t.Append("<h"+(this.blockType-nt+1).toString()+">"),n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen),t.Append("</h"+(this.blockType-nt+1).toString()+">\n");break;case wt:t.Append("<hr />\n");return;case a:case c:t.Append("<li>"),n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen),t.Append("</li>\n");break;case y:t.Append(this.buf.substr(this.contentStart,this.contentLen));return;case lt:t.HtmlEncode(this.buf,this.contentStart,this.contentLen);return;case oi:for(t.Append("<pre"),n.FormatCodeBlockAttributes!=null&&t.Append(n.FormatCodeBlockAttributes(this.data)),t.Append("><code>"),h=t,n.FormatCodeBlock&&(h=t,t=new v),f=0;f<this.children.length;f++)l=this.children[f],t.HtmlEncodeAndConvertTabsToSpaces(l.buf,l.contentStart,l.contentLen),t.Append("\n");n.FormatCodeBlock&&(h.Append(n.FormatCodeBlock(t.ToString(),this.data)),t=h),t.Append("</code></pre>\n\n");return;case o:t.Append("<blockquote>\n"),this.RenderChildren(n,t),t.Append("</blockquote>\n");return;case ur:t.Append("<li>\n"),this.RenderChildren(n,t),t.Append("</li>\n");return;case pi:t.Append("<ol>\n"),this.RenderChildren(n,t),t.Append("</ol>\n");return;case di:t.Append("<ul>\n"),this.RenderChildren(n,t),t.Append("</ul>\n");return;case yi:e=this.data,b=e.name.toLowerCase(),b=="a"?n.OnPrepareLink(e):b=="img"&&n.OnPrepareImage(e,n.RenderingTitledImage),e.RenderOpening(t),t.Append("\n"),this.RenderChildren(n,t),e.RenderClosing(t),t.Append("\n");return;case hi:case s:this.RenderChildren(n,t);return;case bi:this.data.Render(n,t);return;case u:t.Append("<dd>"),this.children!=null?(t.Append("\n"),this.RenderChildren(n,t)):n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen),t.Append("</dd>\n");break;case ft:if(this.children==null)for(w=this.get_Content().split("\n"),f=0;f<w.length;f++)d=w[f],t.Append("<dt>"),n.m_SpanFormatter.Format2(t,p(d)),t.Append("</dt>\n");else t.Append("<dt>\n"),this.RenderChildren(n,t),t.Append("</dt>\n");break;case nr:t.Append("<dl>\n"),this.RenderChildren(n,t),t.Append("</dl>\n");return;case li:t.Append("<p>"),this.contentLen>0&&(n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen),t.Append("&nbsp;")),t.Append(this.data),t.Append("</p>\n")}},n.RevertToPlain=function(){this.blockType=r,this.contentStart=this.lineStart,this.contentLen=this.lineLen},n.get_contentEnd=function(){return this.contentStart+this.contentLen},n.set_contentEnd=function(n){this.contentLen=n-this.contentStart},n.get_leadingSpaces=function(){for(var t=0,n=this.lineStart;n<this.lineStart+this.lineLen;n++)if(this.buf.charAt(n)==" ")t++;else break;return t},n.CopyFrom=function(n){return this.blockType=n.blockType,this.buf=n.buf,this.contentStart=n.contentStart,this.contentLen=n.contentLen,this.lineStart=n.lineStart,this.lineLen=n.lineLen,this},n=b.prototype,n.Process=function(n){var t=new yt(n);return this.ScanLines(t)},n.ProcessRange=function(n,t,i){var r=new yt(n,t,i);return this.ScanLines(r)},n.StartTable=function(n,t,i){var r,u;if(i.length>1)return!1;if(i.length==1){if(r=n.m_position,n.m_position=i[0].lineStart,t.m_Headers=t.ParseRow(n),t.m_Headers==null)return!1;n.m_position=r,i.length=0}for(;;){if(r=n.m_position,u=t.ParseRow(n),u!=null){t.m_Rows.push(u);continue}n.m_position=r;break}return!0},n.ScanLines=function(n){for(var e=[],f=[],w=-1,b,t,v,p,y,l;!n.eof();){if(b=w==i,t=this.EvaluateLine(n),w=t.blockType,t.blockType==u&&(t.data=b),t.blockType==st||t.blockType==tr){if(f.length>0&&(l=f.pop(),this.CollapseLines(e,f),l.blockType!=i)){l.RevertToPlain(),l.blockType=t.blockType==st?nt:dr,e.push(l);continue}t.blockType==st?(t.RevertToPlain(),f.push(t)):t.contentLen>=3?(t.blockType=wt,e.push(t)):(t.RevertToPlain(),f.push(t));continue}if(v=f.length>0?f[0].blockType:i,t.blockType==bi)if(p=t.data,y=n.m_position,this.StartTable(n,p,f)){e.push(t);continue}else n.m_position=y,t.RevertToPlain();switch(t.blockType){case i:switch(v){case i:this.FreeBlock(t);break;case r:this.CollapseLines(e,f),this.FreeBlock(t);break;case o:case a:case c:case u:case s:case h:f.push(t)}break;case r:switch(v){case i:case r:f.push(t);break;case o:case a:case c:case u:case s:l=f[f.length-1],l.blockType==i?(this.CollapseLines(e,f),f.push(t)):f.push(t);break;case h:this.CollapseLines(e,f),f.push(t)}break;case h:switch(v){case i:f.push(t);break;case r:case o:l=f[f.length-1],l.blockType==i?(this.CollapseLines(e,f),f.push(t)):(t.RevertToPlain(),f.push(t));break;case a:case c:case h:case u:case s:f.push(t)}break;case o:v!=o&&this.CollapseLines(e,f),f.push(t);break;case a:case c:switch(v){case i:f.push(t);break;case r:case o:l=f[f.length-1],l.blockType==i||this.m_parentType==a||this.m_parentType==c||this.m_parentType==u?(this.CollapseLines(e,f),f.push(t)):(t.RevertToPlain(),f.push(t));break;case a:case c:case u:case s:t.blockType!=v&&this.CollapseLines(e,f),f.push(t);break;case h:this.CollapseLines(e,f),f.push(t)}break;case u:case s:switch(v){case i:case r:case u:case s:this.CollapseLines(e,f),f.push(t);break;default:t.RevertToPlain(),f.push(t)}break;default:this.CollapseLines(e,f),e.push(t)}}return this.CollapseLines(e,f),this.m_Markdown.ExtraMode&&this.BuildDefinitionLists(e),e},n.CreateBlock=function(n){var t;return t=this.m_Markdown.m_SpareBlocks.length>1?this.m_Markdown.m_SpareBlocks.pop():new ai,t.lineStart=n,t},n.FreeBlock=function(n){this.m_Markdown.m_SpareBlocks.push(n)},n.FreeBlocks=function(n){for(var t=0;t<n.length;t++)this.m_Markdown.m_SpareBlocks.push(n[t]);n.length=0},n.RenderLines=function(n){for(var r=this.m_Markdown.GetStringBuilder(),i,t=0;t<n.length;t++)i=n[t],r.Append(i.buf.substr(i.contentStart,i.contentLen)),r.Append("\n");return r.ToString()},n.CollapseLines=function(n,t){for(var l,d,k,w,v,y,e,f,p;t.length>0&&t[t.length-1].blockType==i;)this.FreeBlock(t.pop());if(t.length!=0)switch(t[0].blockType){case r:l=this.CreateBlock(t[0].lineStart),l.blockType=r,l.buf=t[0].buf,l.contentStart=t[0].contentStart,l.set_contentEnd(t[t.length-1].get_contentEnd()),n.push(l),this.FreeBlocks(t);break;case o:d=this.RenderLines(t),k=new b(this.m_Markdown,this.m_bMarkdownInHtml),k.m_parentType=o,w=this.CreateBlock(t[0].lineStart),w.blockType=o,w.children=k.Process(d),this.FreeBlocks(t),n.push(w);break;case a:case c:n.push(this.BuildList(t));break;case u:if(n.length>0){v=n[n.length-1];switch(v.blockType){case r:v.blockType=ft;break;case u:break;default:y=this.CreateBlock(v.lineStart),y.blockType=ft,y.children=[],y.children.push(v),n.pop(),n.push(y)}}n.push(this.BuildDefinition(t));break;case s:this.m_Markdown.AddFootnote(this.BuildFootnote(t));break;case h:for(e=this.CreateBlock(t[0].lineStart),e.blockType=oi,e.children=[],f=t[0].get_Content(),f.substr(0,2)=="{{"&&f.substr(f.length-2,2)=="}}"&&(e.data=f.substr(2,f.length-4),t.splice(0,1)),p=0;p<t.length;p++)e.children.push(t[p]);n.push(e),t.length=0}},n.EvaluateLine=function(n){var t=this.CreateBlock(n.m_position);return t.buf=n.buf,t.contentStart=n.m_position,t.contentLen=-1,t.blockType=this.EvaluateLineInternal(n,t),t.contentLen<0&&(n.SkipToEol(),t.contentLen=n.m_position-t.contentStart),t.lineLen=n.m_position-t.lineStart,n.SkipEol(),t},n.EvaluateLineInternal=function(n,t){var v,e,y,b,tt,l,it,rt,w,k,ft,ut,d,g;if(n.eol())return i;if(v=n.m_position,e=n.current(),e=="#"){for(y=1,n.SkipForward(1);n.current()=="#";)y++,n.SkipForward(1);for(y>6&&(y=6),n.SkipLinespace(),t.contentStart=n.m_position,n.SkipToEol(),this.m_Markdown.ExtraMode&&!this.m_Markdown.SafeMode&&(b=yr(n.buf,t.contentStart,n.m_position),b!=null&&(t.data=b.id,n.m_position=b.end));n.m_position>t.contentStart&&n.CharAtOffset(-1)=="#";)n.SkipForward(-1);while(n.m_position>t.contentStart&&f(n.CharAtOffset(-1)))n.SkipForward(-1);return t.contentLen=n.m_position-t.contentStart,n.SkipToEol(),nt+(y-1)}if(e=="-"||e=="="){for(w=e;n.current()==w;)n.SkipForward(1);if(n.SkipLinespace(),n.eol())return w=="="?st:tr;n.m_position=v}if(this.m_Markdown.ExtraMode){if(tt=uu(n),tt!=null)return t.data=tt,bi;if(n.m_position=v,e=="~"){if(this.ProcessFencedCodeBlock(n,t))return t.blockType;n.m_position=v}}for(l=-1,it=0;!n.eol();){if(n.current()==" ")l<0&&it++;else if(n.current()=="\t")l<0&&(l=n.m_position);else break;n.SkipForward(1)}if(n.eol())return t.contentLen=0,i;if(it>=4)return t.contentStart=v+4,h;if(l>=0&&l-v<4)return t.contentStart=l+1,h;if(t.contentStart=n.m_position,e=n.current(),e=="<"){if(this.ScanHtml(n,t))return t.blockType;n.m_position=t.contentStart}if(e==">")return at(n.CharAtOffset(1))?(n.SkipForward(2),t.contentStart=n.m_position,o):(n.SkipForward(1),t.contentStart=n.m_position,o);if(e=="-"||e=="_"||e=="*"){for(rt=0;!n.eol();){if(w=n.current(),n.current()==e){rt++,n.SkipForward(1);continue}if(at(n.current())){n.SkipForward(1);continue}break}if(n.eol()&&rt>=3)return wt;n.m_position=t.contentStart}if(this.m_Markdown.ExtraMode&&e=="*"&&n.CharAtOffset(1)=="["){for(n.SkipForward(2),n.SkipLinespace(),n.Mark();!n.eol()&&n.current()!="]";)n.SkipForward(1);if(k=p(n.Extract()),n.current()=="]"&&n.CharAtOffset(1)==":"&&k)return n.SkipForward(2),n.SkipLinespace(),n.Mark(),n.SkipToEol(),ft=n.Extract(),this.m_Markdown.AddAbbreviation(k,ft),i;n.m_position=t.contentStart}if((e=="*"||e=="+"||e=="-")&&at(n.CharAtOffset(1)))return n.SkipForward(1),n.SkipLinespace(),t.contentStart=n.m_position,c;if(e==":"&&this.m_Markdown.ExtraMode&&at(n.CharAtOffset(1)))return n.SkipForward(1),n.SkipLinespace(),t.contentStart=n.m_position,u;if(fi(e)){for(n.SkipForward(1);fi(n.current());)n.SkipForward(1);if(n.SkipChar(".")&&n.SkipLinespace())return t.contentStart=n.m_position,a;n.m_position=t.contentStart}if(e=="["){if(this.m_Markdown.ExtraMode&&n.CharAtOffset(1)=="^"){if(ut=n.m_position,n.SkipForward(2),d=n.SkipFootnoteID(),d!=null&&n.SkipChar("]")&&n.SkipChar(":"))return n.SkipLinespace(),t.contentStart=n.m_position,t.data=d,s;n.m_position=ut}if(g=gu(n,this.m_Markdown.ExtraMode),g!=null)return this.m_Markdown.AddLinkDefinition(g),i}return r};var ki=0,dt=1,gt=2,vt=3,ni=4;n.GetMarkdownMode=function(n){var t=n.attributes.markdown;return t==undefined?this.m_bMarkdownInHtml?vt:ki:(delete n.attributes.markdown,t=="1")?(n.get_Flags()&lr)!=0?gt:dt:t=="block"?dt:t=="deep"?vt:t=="span"?gt:ni},n.ProcessMarkdownEnabledHtml=function(n,t,i,r){for(var f=n.m_position,s=1,h=!1,o,e,c,u;!n.eof();){if(!n.Find("<"))break;if(o=n.m_position,e=pt(n),e==null){n.SkipForward(1);continue}if((this.m_Markdown.SafeMode&&r==ni&&!h&&(e.IsSafe()||(h=!0)),!e.closed)&&e.name==i.name)if(e.closing){if(s--,s==0){n.SkipLinespace(),n.SkipEol(),t.blockType=yi,t.data=i,t.set_contentEnd(n.m_position);switch(r){case gt:u=this.CreateBlock(f),u.buf=n.buf,u.blockType=ci,u.contentStart=f,u.contentLen=o-f,t.children=[],t.children.push(u);break;case dt:case vt:c=new b(this.m_Markdown,r==vt),t.children=c.ProcessRange(n.buf,f,o-f);break;case ni:h?(t.blockType=lt,t.set_contentEnd(n.m_position)):(u=this.CreateBlock(f),u.buf=n.buf,u.blockType=y,u.contentStart=f,u.contentLen=o-f,t.children=[],t.children.push(u))}return!0}}else s++}return!1},n.ScanHtml=function(n,t){var f=n.m_position,e=pt(n),h,a,v,b,o,w,c,u,s,l,r,k;if(e==null||e.closing||(h=!1,this.m_Markdown.SafeMode&&!e.IsSafe()&&(h=!0),a=e.get_Flags(),(a&cr)==0))return!1;if((a&ar)!=0||e.closed)return n.SkipLinespace(),n.SkipEol(),t.contentLen=n.m_position-t.contentStart,t.blockType=h?lt:y,!0;if((a&si)!=0&&(n.SkipLinespace(),!n.eol()))return!1;if(v=this.m_Markdown.ExtractHeadBlocks&&e.name.toLowerCase()=="head",b=n.m_position,!v&&this.m_Markdown.ExtraMode&&(s=this.GetMarkdownMode(e),s!=ki))return this.ProcessMarkdownEnabledHtml(n,t,e,s);for(o=null,w=1;!n.eof();){if(!n.Find("<"))break;if(c=n.m_position,u=pt(n),u==null){n.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&!u.IsSafe()&&(h=!0),!u.closed){if(!v&&!u.closing&&this.m_Markdown.ExtraMode&&!h&&(s=this.GetMarkdownMode(u),s!=ki))if(l=this.CreateBlock(f),this.ProcessMarkdownEnabledHtml(n,l,u,s)){o==null&&(o=[]),c>f&&(r=this.CreateBlock(f),r.buf=n.buf,r.blockType=y,r.contentStart=f,r.contentLen=c-f,o.push(r)),o.push(l),f=n.m_position;continue}else this.FreeBlock(l);if(u.name==e.name&&!u.closed)if(u.closing){if(w--,w==0)return(n.SkipLinespace(),n.SkipEol(),h)?(t.blockType=lt,t.set_contentEnd(n.m_position),!0):o!=null?(n.m_position>f&&(r=this.CreateBlock(f),r.buf=n.buf,r.blockType=y,r.contentStart=f,r.contentLen=n.m_position-f,o.push(r)),t.blockType=hi,t.set_contentEnd(n.m_position),t.children=o,!0):v?(k=n.buf.substr(b,c-b),this.m_Markdown.HeadBlockContent=this.m_Markdown.HeadBlockContent+p(k)+"\n",t.blockType=y,t.contentStart=n.position,t.contentEnd=n.position,t.lineStart=n.position,!0):(t.blockType=y,t.contentLen=n.m_position-t.contentStart,!0)}else w++}}return i},n.BuildList=function(n){for(var l=n[0].blockType,g=n[0].get_leadingSpaces(),k,d,f,o,e,w,v,a,s,p,u,y,t=1;t<n.length;t++){if(n[t].blockType==r&&(n[t-1].blockType==r||n[t-1].blockType==l)){n[t-1].set_contentEnd(n[t].get_contentEnd()),this.FreeBlock(n[t]),n.splice(t,1),t--;continue}n[t].blockType!=h&&n[t].blockType!=i&&(k=n[t].get_leadingSpaces(),k>g&&(n[t].blockType=h,d=n[t].get_contentEnd(),n[t].contentStart=n[t].lineStart+k,n[t].set_contentEnd(d)))}for(f=this.CreateBlock(0),f.blockType=l==c?di:pi,f.children=[],t=0;t<n.length;t++){for(o=t;o>0&&n[o-1].blockType==i;)o--;for(e=t;e<n.length-1&&n[e+1].blockType!=l;)e++;if(o==e)f.children.push(this.CreateBlock().CopyFrom(n[t]));else{for(w=!1,v=this.m_Markdown.GetStringBuilder(),u=o;u<=e;u++)a=n[u],v.Append(a.buf.substr(a.contentStart,a.contentLen)),v.Append("\n"),n[u].blockType==i&&(w=!0);if(s=this.CreateBlock(),s.blockType=ur,s.lineStart=n[o].lineStart,p=new b(this.m_Markdown),p.m_parentType=l,s.children=p.Process(v.ToString()),!w)for(u=0;u<s.children.length;u++)y=s.children[u],y.blockType==r&&(y.blockType=ci);f.children.push(s)}t=e}return f.lineStart=f.children[0].lineStart,this.FreeBlocks(n),n.length=0,f},n.BuildDefinition=function(n){for(var h,s,i,f,e,o,t=1;t<n.length;t++)if(n[t].blockType==r&&(n[t-1].blockType==r||n[t-1].blockType==u)){n[t-1].set_contentEnd(n[t].get_contentEnd()),this.FreeBlock(n[t]),n.splice(t,1),t--;continue}if(h=n[0].data,n.length==1&&!h)return s=n[0],n.length=0,s;for(i=this.m_Markdown.GetStringBuilder(),t=0;t<n.length;t++)f=n[t],i.Append(f.buf.substr(f.contentStart,f.contentLen)),i.Append("\n");return e=this.CreateBlock(n[0].lineStart),e.blockType=u,o=new b(this.m_Markdown),o.m_parentType=u,e.children=o.Process(i.ToString()),this.FreeBlocks(n),n.length=0,e},n.BuildDefinitionLists=function(n){for(var i=null,t=0;t<n.length;t++)switch(n[t].blockType){case ft:case u:i==null&&(i=this.CreateBlock(n[t].lineStart),i.blockType=nr,i.children=[],n.splice(t,0,i),t++),i.children.push(n[t]),n.splice(t,1),t--;break;default:i=null}},n.BuildFootnote=function(n){for(var u,f,e,i,t=1;t<n.length;t++)if(n[t].blockType==r&&(n[t-1].blockType==r||n[t-1].blockType==s)){n[t-1].set_contentEnd(n[t].get_contentEnd()),this.FreeBlock(n[t]),n.splice(t,1),t--;continue}for(u=this.m_Markdown.GetStringBuilder(),t=0;t<n.length;t++)f=n[t],u.Append(f.buf.substr(f.contentStart,f.contentLen)),u.Append("\n");return e=new b(this.m_Markdown),e.m_parentType=s,i=this.CreateBlock(n[0].lineStart),i.blockType=s,i.data=n[0].data,i.children=e.Process(u.ToString()),this.FreeBlocks(n),n.length=0,i},n.ProcessFencedCodeBlock=function(n,t){var e=n.m_position,r,f,u,i;for(n.Mark();n.current()=="~";)n.SkipForward(1);return(r=n.Extract(),r.length<3)?!1:(n.SkipLinespace(),!n.eol())?!1:(n.SkipEol(),f=n.m_position,!n.Find(r))?!1:ii(n.CharAtOffset(-1))?(u=n.m_position,n.SkipForward(r.length),n.SkipLinespace(),!n.eol())?!1:(t.blockType=oi,t.children=[],u--,i=this.CreateBlock(e),i.blockType=h,i.buf=n.buf,i.contentStart=f,i.contentLen=u-f,t.children.push(i),!0):!1};var ou=0,rr=1,fr=2,ir=3;n=kt.prototype,n.LeadingBar=!1,n.TrailingBar=!1,n.ParseRow=function(n){var i,t;if(n.SkipLinespace(),n.eol())return null;if(i=this.LeadingBar,this.LeadingBar&&!n.SkipChar("|"))return i=!0,null;for(t=[];!n.eol();){for(n.Mark();!n.eol()&&n.current()!="|";)n.SkipForward(1);t.push(p(n.Extract())),i|=n.SkipChar("|")}if(!i)return null;while(t.length<this.m_Columns.length)t.push("&nbsp;");return n.SkipEol(),t},n.RenderRow=function(n,t,i,r){for(var u=0;u<i.length;u++){if(t.Append("\t<"),t.Append(r),u<this.m_Columns.length)switch(this.m_Columns[u]){case rr:t.Append(' align="left"');break;case fr:t.Append(' align="right"');break;case ir:t.Append(' align="center"')}t.Append(">"),n.m_SpanFormatter.Format2(t,i[u]),t.Append("</"),t.Append(r),t.Append(">\n")}},n.Render=function(n,t){var i,r;for(t.Append("<table>\n"),this.m_Headers!=null&&(t.Append("<thead>\n<tr>\n"),this.RenderRow(n,t,this.m_Headers,"th"),t.Append("</tr>\n</thead>\n")),t.Append("<tbody>\n"),i=0;i<this.m_Rows.length;i++)r=this.m_Rows[i],t.Append("<tr>\n"),this.RenderRow(n,t,r,"td"),t.Append("</tr>\n");t.Append("</tbody>\n"),t.Append("</table>\n")},this.Markdown=l,this.HtmlTag=g},MarkdownDeepEditor=new function(){function u(n,t){return n.substr(0,t.length)==t}function et(n,t){return n.substr(-t.length)==t}function i(n){return n==" "||n=="\t"||n=="\r"||n=="\n"}function r(n){return n=="\r"||n=="\n"}function o(n){for(var t=0,r=n.length;t<r&&i(n.charAt(t));)t++;while(r-1>t&&i(n.charAt(r-1)))r--;return n.substr(t,r-t)}function e(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i)}function v(n){return n.preventDefault&&n.preventDefault(),n.cancelBubble!==undefined&&(n.cancelBubble=!0,n.keyCode=0,n.returnValue=!1),!1}function f(){}function b(n,t,i,r){return n<t?n:n<t+i?t:n+r-i}function a(n,t){n.setSelectionRange||(s=!0),this.m_lastContent=null,this.m_undoStack=[],this.m_undoPos=0,this.m_undoMode=h,this.Markdown=new MarkdownDeep.Markdown,this.Markdown.SafeMode=!1,this.Markdown.ExtraMode=!0,this.Markdown.NewWindowForLocalLinks=!0,this.Markdown.NewWindowForExternalLinks=!0,this.m_textarea=n,this.m_divHtml=t;var i=this;e(n,"keyup",function(){i.onMarkdownChanged()}),e(n,"keydown",function(n){return i.onKeyDown(n)}),e(n,"paste",function(){i.onMarkdownChanged()}),e(n,"input",function(){i.onMarkdownChanged()}),e(n,"mousedown",function(){i.SetUndoMode(h)}),this.onMarkdownChanged()}var s=!1,g=9,y=13,d=33,k=34,tt=36,ot=35,ht=37,rt=39,nt=38,ut=40,ft=8,it=46,c=0,l=1,w=2,h=3,st=4,p={Z:"undo",Y:"redo",B:"bold",I:"italic",H:"heading",K:"code",U:"ullist",O:"ollist",Q:"indent",E:"outdent",L:"link",G:"img",R:"hr","0":"h0","1":"h1","2":"h2","3":"h3","4":"h4","5":"h5","6":"h6"},n,t;n=f.prototype,n.InitFromTextArea=function(n){var t,r,i;this.m_textarea=n,s?(t=document.selection.createRange(),r=t.duplicate(),r.moveToElementText(n),i=-r.moveStart("character",-1e7),this.m_selectionStart=-t.moveStart("character",-1e7)-i,this.m_selectionEnd=-t.moveEnd("character",-1e7)-i,this.m_text=n.value.replace(/\r\n/gm,"\n")):(this.m_selectionStart=n.selectionStart,this.m_selectionEnd=n.selectionEnd,this.m_text=n.value)},n.Duplicate=function(){var n=new f;return n.m_textarea=this.m_textarea,n.m_selectionEnd=this.m_selectionEnd,n.m_selectionStart=this.m_selectionStart,n.m_text=this.m_text,n},n.Apply=function(){var n,t;s?(this.m_textarea.value=this.m_text,this.m_textarea.focus(),n=this.m_textarea.createTextRange(),n.collapse(!0),n.moveEnd("character",this.m_selectionEnd),n.moveStart("character",this.m_selectionStart),n.select()):(t=this.m_textarea.scrollTop,this.m_textarea.value=this.m_text,this.m_textarea.focus(),this.m_textarea.setSelectionRange(this.m_selectionStart,this.m_selectionEnd),this.m_textarea.scrollTop=t)},n.ReplaceSelection=function(n){this.m_text=this.m_text.substr(0,this.m_selectionStart)+n+this.m_text.substr(this.m_selectionEnd),this.m_selectionEnd=this.m_selectionStart+n.length},n.ReplaceAt=function(n,t,i){this.m_text=this.m_text.substr(0,n)+i+this.m_text.substr(n+t),this.m_selectionStart=b(this.m_selectionStart,n,t,i.length),this.m_selectionEnd=b(this.m_selectionEnd,n,t,i.length)},n.getSelectedText=function(){return this.m_text.substr(this.m_selectionStart,this.m_selectionEnd-this.m_selectionStart)},n.InflateSelection=function(n,t){this.m_selectionEnd+=t,this.m_selectionStart-=n},n.PreceededBy=function(n){return this.m_selectionStart>=n.length&&this.m_text.substr(this.m_selectionStart-n.length,n.length)==n},n.FollowedBy=function(n){return this.m_text.substr(this.m_selectionEnd,n.length)==n},n.TrimSelection=function(){while(i(this.m_text.charAt(this.m_selectionStart)))this.m_selectionStart++;while(this.m_selectionEnd>this.m_selectionStart&&i(this.m_text.charAt(this.m_selectionEnd-1)))this.m_selectionEnd--},n.IsStartOfLine=function(n){return n==0||r(this.m_text.charAt(n-1))},n.FindStartOfLine=function(n){while(n>0&&!r(this.m_text.charAt(n-1)))n--;return n},n.FindEndOfLine=function(n){while(n<this.m_text.length&&!r(this.m_text.charAt(n)))n++;return n},n.FindNextLine=function(n){return this.SkipEol(this.FindEndOfLine(n))},n.SkipWhiteSpace=function(n){while(n<this.m_text.length&&i(this.m_text.charAt(n)))n++;return n},n.SkipEol=function(n){return this.m_text.substr(n,2)=="\r\n"?n+2:r(this.m_text.charAt(n))?n+1:n},n.SkipPreceedingEol=function(n){return n>2&&this.m_text.substr(n-2,2)=="\r\n"?n-2:n>1&&r(this.m_text.charAt(n-1))?n-1:n},n.SelectWholeLines=function(){this.m_selectionStart=this.FindStartOfLine(this.m_selectionStart),this.IsStartOfLine(this.m_selectionEnd)||(this.m_selectionEnd=this.SkipEol(this.FindEndOfLine(this.m_selectionEnd)))},n.SkipPreceedingWhiteSpace=function(n){while(n>0&&i(this.m_text.charAt(n-1)))n--;return n},n.SkipFollowingWhiteSpace=function(n){while(i(this.m_text.charAt(n)))n++;return n},n.SelectSurroundingWhiteSpace=function(){this.m_selectionStart=this.SkipPreceedingWhiteSpace(this.m_selectionStart),this.m_selectionEnd=this.SkipFollowingWhiteSpace(this.m_selectionEnd)},n.CheckSimpleSelection=function(){var t=this.getSelectedText(),n=t.match(/\n[ \t\r]*\n/);return n?(alert("Please make a selection that doesn't include a paragraph break"),!1):!0},n.IsBlankLine=function(n){for(var f=this.m_text.length,u,t=n;t<f;t++){if(u=this.m_text[t],r(u))return!0;if(!i(this.m_text.charAt(t)))return!1}return!0},n.FindStartOfParagraph=function(n){var i=n,t;if(n=this.FindStartOfLine(n),this.IsBlankLine(n))return n;while(n>0){if(t=this.FindStartOfLine(this.SkipPreceedingEol(n)),t==0)break;if(this.IsBlankLine(t))break;n=t}if(this.DetectListType(n).m_prefixLen!=0)for(n=this.FindStartOfLine(i);n>0;){if(this.DetectListType(n).m_prefixLen!=0)return n;n=this.FindStartOfLine(this.SkipPreceedingEol(n))}return n},n.FindEndOfParagraph=function(n){while(n<this.m_text.length){if(this.IsBlankLine(n))break;n=this.FindNextLine(n)}return n},n.SelectParagraph=function(){this.m_selectionStart=this.FindStartOfParagraph(this.m_selectionStart),this.m_selectionEnd=this.FindEndOfParagraph(this.m_selectionStart)},n.DetectListType=function(n){var i=this.m_text.substr(n,10),t=i.match(/^\s{0,3}(\*|\d+\.)(?:\ |\t)*/);return t?t[1]=="*"?{m_listType:"*",m_prefixLen:t[0].length}:{m_listType:"1",m_prefixLen:t[0].length}:{m_listType:"",m_prefixLen:0}},n=a.prototype,t=a.prototype,n.onKeyDown=function(n){var t=null,r=!0,i;if(n.ctrlKey||n.metaKey){if(i=String.fromCharCode(n.charCode||n.keyCode),!this.disableShortCutKeys&&p[i]!=undefined)return this.InvokeCommand(p[i]),v(n);switch(i){case"V":t=l;break;case"X":t=w}}else switch(n.keyCode){case g:if(this.disableTabHandling)t=l;else return this.InvokeCommand(n.shiftKey?"untab":"tab"),v(n);break;case ht:case rt:case nt:case ut:case tt:case ot:case d:case k:t=h;break;case ft:case it:t=w;break;case y:t=st;break;default:t=l}t!=null&&this.SetUndoMode(t),this.disableAutoIndent||n.keyCode==y&&(!s||n.ctrlKey)&&this.IndentNewLine()},n.SetUndoMode=function(n){this.m_undoMode!=n&&(this.m_undoMode=n,this.CaptureUndoState())},n.CaptureUndoState=function(){var n=new f;n.InitFromTextArea(this.m_textarea),this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,n),this.m_undoPos=this.m_undoStack.length},n.onMarkdownChanged=function(){var t=this.m_textarea.value,i;if(t!==this.m_lastContent||this.m_lastContent===null){if(this.onPreTransform)this.onPreTransform(this,t);if(i=this.Markdown.Transform(t),this.onPostTransform)this.onPostTransform(this,i);if(this.m_divHtml&&(this.m_divHtml.innerHTML=i),this.onPostUpdateDom)this.onPostUpdateDom(this);this.m_lastContent=t}},t.onOptionsChanged=function(){this.m_lastContent=null,this.onMarkdownChanged()},t.cmd_undo=function(){this.m_undoPos>0&&(this.m_undoPos==this.m_undoStack.length&&(this.CaptureUndoState(),this.m_undoPos--),this.m_undoPos--,this.m_undoStack[this.m_undoPos].Apply(),this.m_undoMode=c,this.onMarkdownChanged())},t.cmd_redo=function(){this.m_undoPos+1<this.m_undoStack.length&&(this.m_undoPos++,this.m_undoStack[this.m_undoPos].Apply(),this.m_undoMode=c,this.onMarkdownChanged(),this.m_undoPos==this.m_undoStack.length-1&&this.m_undoStack.pop())},n.setHeadingLevel=function(n,t){var i,f,r,u,s,e,h;if(n.SelectParagraph(),n.SelectSurroundingWhiteSpace(),i=n.getSelectedText(),i=o(i),f=0,r=i.match(/^(\#+)(.*?)(\#+)?$/),r?(i=o(r[2]),f=r[1].length):(r=i.match(/^(.*?)(?:\r\n|\n|\r)\s*(\-*|\=*)$/),r?(i=o(r[1]),f=r[2].charAt(0)=="="?1:0):(i=i.replace(/(\r\n|\n|\r)/gm,""),f=0)),t==-1&&(t=(f+1)%4),u=0,s=0,t==0){if(i=="Heading")return n.ReplaceSelection(""),!0;s=i.length,u=0}else{for(i==""&&(i="Heading"),u=t+1,s=i.length,e="",h=0;h<t;h++)e+="#";i=e+" "+i+" "+e}return i+="\n\n",n.m_selectionStart!=0&&(i="\n\n"+i,u+=2),n.ReplaceSelection(i),n.m_selectionStart+=u,n.m_selectionEnd=n.m_selectionStart+s,!0},t.cmd_heading=function(n){return this.setHeadingLevel(n,-1)},t.cmd_h0=function(n){return this.setHeadingLevel(n,0)},t.cmd_h1=function(n){return this.setHeadingLevel(n,1)},t.cmd_h2=function(n){return this.setHeadingLevel(n,2)},t.cmd_h3=function(n){return this.setHeadingLevel(n,3)},t.cmd_h4=function(n){return this.setHeadingLevel(n,4)},t.cmd_h5=function(n){return this.setHeadingLevel(n,5)},t.cmd_h6=function(n){return this.setHeadingLevel(n,6)},n.IndentCodeBlock=function(n,t){var r,e,f,h,i,s;for(n.SelectWholeLines(),r=n.getSelectedText().split("\n"),i=0;i<r.length;i++)if(r[i].charAt(0)=="\t"){for(e="",f=0;r[i].charAt(f)=="\t";)e+="    ",f++;h=e+r[i].substr(f),r.splice(i,1,h)}if(t===null){for(i=0;i<r.length;i++)if(o(r[i])!=""){if(r[i].charAt(0)=="\t"){for(e="",f=0;r[i].charAt(f)=="\t";)e+="    ",f++;h=e+r[i].substr(i),r.splice(i,1,h)}if(!u(r[i],"    "))break}t=i!=r.length}for(i=0;i<r.length;i++)o(r[i])!=""&&(s=r[i],t?s="    "+r[i]:u(r[i],"\t")?s=r[i].substr(1):u(r[i],"    ")&&(s=r[i].substr(4)),r.splice(i,1,s));n.ReplaceSelection(r.join("\n"))},t.cmd_code=function(n){if(n.m_selectionStart==n.m_selectionEnd){var t=n.FindStartOfLine(n.m_selectionStart);if(n.IsBlankLine(t))return n.SelectSurroundingWhiteSpace(),n.ReplaceSelection("\n\n    Code\n\n"),n.m_selectionStart+=6,n.m_selectionEnd=n.m_selectionStart+4,!0}return n.getSelectedText().indexOf("\n")<0?(n.TrimSelection(),n.PreceededBy("`")&&n.m_selectionStart--,n.FollowedBy("`")&&n.m_selectionEnd++,this.bold_or_italic(n,"`")):(this.IndentCodeBlock(n,null),!0)},t.cmd_tab=function(n){var i,t,r;if(n.getSelectedText().indexOf("\n")>0)this.IndentCodeBlock(n,!0);else{for(i=n.FindStartOfLine(n.m_selectionStart),t=i;t<n.m_selectionStart;t++)if(n.m_text.charAt(t)!=" ")break;t==n.m_selectionStart?(r=4-(t-i)%4,n.ReplaceSelection("    ".substr(0,r))):n.ReplaceSelection("\t"),n.m_selectionStart=n.m_selectionEnd}return!0},t.cmd_untab=function(n){return n.getSelectedText().indexOf("\n")>0?(this.IndentCodeBlock(n,!1),!0):!1},n.bold_or_italic=function(n,t){var f=n.m_text,r=t.length,i=n.getSelectedText();return u(i,t)&&et(i,t)?n.ReplaceSelection(i.substr(r,i.length-r*2)):(n.TrimSelection(),i=n.getSelectedText(),i=i?i.replace(/(\r\n|\n|\r)/gm,""):"text",n.ReplaceSelection(t+i+t),n.InflateSelection(-r,-r)),!0},t.cmd_bold=function(n){return n.CheckSimpleSelection()?(n.TrimSelection(),n.PreceededBy("**")&&(n.m_selectionStart-=2),n.FollowedBy("**")&&(n.m_selectionEnd+=2),this.bold_or_italic(n,"**")):!1},t.cmd_italic=function(n){return n.CheckSimpleSelection()?(n.TrimSelection(),(n.PreceededBy("*")&&!n.PreceededBy("**")||n.PreceededBy("***"))&&(n.m_selectionStart-=1),(n.FollowedBy("*")&&!n.PreceededBy("**")||n.FollowedBy("***"))&&(n.m_selectionEnd+=1),this.bold_or_italic(n,"*")):!1},n.indent_or_outdent=function(n,t){var r,i,f;if(!1&&n.m_selectionStart==n.m_selectionEnd)return n.SelectSurroundingWhiteSpace(),n.ReplaceSelection("\n\n> Quote\n\n"),n.m_selectionStart+=4,n.m_selectionEnd=n.m_selectionStart+5,!0;for(n.SelectWholeLines(),r=n.getSelectedText().split("\n"),i=0;i<r.length-1;i++)f=r[i],t?u(r[i],"> ")&&(f=r[i].substr(2)):f="> "+r[i],r.splice(i,1,f);return n.ReplaceSelection(r.join("\n")),!0},t.cmd_indent=function(n){return this.indent_or_outdent(n,!1)},t.cmd_outdent=function(n){return this.indent_or_outdent(n,!0)},n.handle_list=function(n,t){var f=[],c,u,h,r,o,i,e,l,s;if(n.getSelectedText().indexOf("\n")>0)for(n.SelectWholeLines(),u=n.m_selectionStart,f.push(u);;){if(u=n.FindNextLine(u),u>=n.m_selectionEnd)break;f.push(u)}else f.push(n.FindStartOfLine(n.m_selectionStart));for(c=t=="*"?"* ":"1. ",i=0;i<f.length;i++)if(e=n.DetectListType(f[i]),e.m_listType==t){c="";break}for(i=f.length-1;i>=0;i--)u=f[i],e=n.DetectListType(u),n.ReplaceAt(u,e.m_prefixLen,c);for(h=new MarkdownDeep.Markdown,h.ExtraMode=!0,r=h.GetListItems(n.m_text,n.m_selectionStart);r!=null;){for(o=0,i=0;i<r.length-1;i++){if(e=n.DetectListType(r[i]+o),e.m_listType!="1")break;l=(i+1).toString()+". ",n.ReplaceAt(r[i]+o,e.m_prefixLen,l),o+=l.length-e.m_prefixLen}s=h.GetListItems(n.m_text,r[r.length-1]+o),r=s!=null&&s[0]!=r[0]?s:null}return f.length>1&&n.SelectWholeLines(),!0},t.cmd_ullist=function(n){return this.handle_list(n,"*")},t.cmd_ollist=function(n){return this.handle_list(n,"1")},t.cmd_link=function(n){var i,t,r;return(n.TrimSelection(),!n.CheckSimpleSelection())?!1:(i=prompt("Enter the target URL:"),i===null)?!1:(t=n.getSelectedText(),t.length==0&&(t="link text"),r="["+t+"]("+i+")",n.ReplaceSelection(r),n.m_selectionStart++,n.m_selectionEnd=n.m_selectionStart+t.length,!0)},t.cmd_img=function(n){var i,t,r;return(n.TrimSelection(),!n.CheckSimpleSelection())?!1:(i=prompt("Enter the image URL"),i===null)?!1:(t=n.getSelectedText(),t.length==0&&(t="Image Text"),r="!["+t+"]("+i+")",n.ReplaceSelection(r),n.m_selectionStart+=2,n.m_selectionEnd=n.m_selectionStart+t.length,!0)},t.cmd_hr=function(n){return n.SelectSurroundingWhiteSpace(),n.m_selectionStart==0?n.ReplaceSelection("----------\n\n"):n.ReplaceSelection("\n\n----------\n\n"),n.m_selectionStart=n.m_selectionEnd,!0},t.IndentNewLine=function(){var i=this,n,t=function(){var t,u,r,e;for(window.clearInterval(n),t=new f,t.InitFromTextArea(i.m_textarea),u=t.FindStartOfLine(t.SkipPreceedingEol(t.m_selectionStart)),r=u;;){if(e=t.m_text.charAt(r),e!=" "&&e!="\t")break;r++}r>u&&(t.ReplaceSelection(t.m_text.substr(u,r-u)),t.m_selectionStart=t.m_selectionEnd),t.Apply()};return n=window.setInterval(t,1),!1},t.cmd_indented_newline=function(n){var i,t,r;for(n.ReplaceSelection("\n"),n.m_selectionStart=n.m_selectionEnd,i=n.FindStartOfLine(n.SkipPreceedingEol(n.m_selectionStart)),t=i;;){if(r=n.m_text.charAt(t),r!=" "&&r!="\t")break;t++}return t>i&&(n.ReplaceSelection(n.m_text.substr(i,t-i)),n.m_selectionStart=n.m_selectionEnd),!0},t.InvokeCommand=function(n){var t,i;if(n=="undo"||n=="redo"){this["cmd_"+n](),this.m_textarea.focus();return}return t=new f,t.InitFromTextArea(this.m_textarea),i=t.Duplicate(),this["cmd_"+n](t)?(this.m_undoMode=c,this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,i),this.m_undoPos++,t.Apply(),this.onMarkdownChanged(),!0):(this.m_textarea.focus(),!1)},delete n,delete t,this.Editor=a},MarkdownDeepEditorUI=new function(){this.HelpHtmlWritten=!1,this.HelpHtml=function(n){var t="";return t+='<div class="mdd_modal" id="mdd_syntax_container" style="display:none">\n',t+='<div class="mdd_modal_frame">\n',t+='<div class="mdd_modal_button">\n',t+='<a href="'+n+'" id="mdd_help_location" style="display:none"></a>\n',t+='<a href="#" id="mdd_close_help">Close</a>\n',t+="</div>\n",t+='<div class="mdd_modal_content">\n',t+='<div class="mdd_syntax" id="mdd_syntax">\n',t+='<div class="mdd_ajax_loader"></div>\n',t+="</div>\n",t+="</div>\n",t+="</div>\n",t+="</div>\n"},this.ToolbarHtml=function(){var n="";return n+='<div class="mdd_links">\n',n+='<a href="#" class="mdd_help" tabindex=-1>How to Format</a>\n',n+="</div>\n",n+="<ul>\n",n+='<li><a href="#" class="mdd_button" id="mdd_undo" title="Undo (Ctrl+Z)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_redo" title="Redo (Ctrl+Y)" tabindex=-1></a></li>\n',n+='<li><span class="mdd_sep"></span></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_heading" title="Change Heading Style (Ctrl+H, or Ctrl+0 to Ctrl+6)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_code" title="Preformatted Code (Ctrl+K or Tab/Shift+Tab on multiline selection)" tabindex=-1></a></li>\n',n+='<li><span class="mdd_sep"></span></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_bold" title="Bold (Ctrl+B)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_italic" title="Italic (Ctrl+I)" tabindex=-1></a></li>\n',n+='<li><span class="mdd_sep"></span></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_ullist" title="Bullets (Ctrl+U)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_ollist" title="Numbering (Ctrl+O)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_outdent" title="Unquote (Ctrl+W)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_indent" title="Quote (Ctrl+Q)" tabindex=-1></a></li>\n',n+='<li><span class="mdd_sep"></span></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_link" title="Insert Hyperlink (Ctrl+L)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_img" title="Insert Image (Ctrl+G)" tabindex=-1></a></li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_hr" title="Insert Horizontal Rule (Ctrl+R)" tabindex=-1></a></li>\n',n+="</ul>\n",n+='<div style="clear:both"></div>\n'},this.onResizerMouseDown=function(n){function i(){return $(document).unbind("mousemove.mdd"),$(document).unbind("mouseup.mdd"),!1}function r(n){var i=f+n.clientY-u;return i<50&&(i=50),$(t).height(i),!1}var t=$(n.srcElement).prevAll("textarea")[0],u=n.clientY,f=$(t).height();return $(document).bind("mousemove.mdd",r),$(document).bind("mouseup.mdd",i),!1};var t=0,n=!1;this.onShowHelpPopup=function(){if($("#mdd_syntax_container").fadeIn("fast"),$(".modal_content").scrollTop(t),$(document).bind("keydown.mdd",function(n){if(n.keyCode==27)return MarkdownDeepEditorUI.onCloseHelpPopup(),!1}),!n){n=!0;var i=$("#mdd_help_location").attr("href");i||(i="mdd_help.htm"),$("#mdd_syntax").load(i)}return!1},this.onCloseHelpPopup=function(){return t=$(".modal_content").scrollTop(),$("#mdd_syntax_container").fadeOut("fast"),$(document).unbind("keydown.mdd"),$(document).unbind("scroll.mdd"),!1},this.onToolbarButton=function(n){var t=$(n.target).closest("div.mdd_toolbar").nextAll("textarea.mdd_editor").data("mdd");return t.InvokeCommand($(n.target).attr("id").substr(4)),!1}};(function(n){n.fn.MarkdownDeep=function(t){var i={resizebar:!0,toolbar:!0,help_location:"mdd_help.html"};return t&&n.extend(i,t),this.each(function(){var u,s,r,o,e,f;i.toolbar&&(u=n(this).prev(".mdd_toolbar"),u.length==0?(u=n('<div class="mdd_toolbar">'+MarkdownDeepEditorUI.ToolbarHtml()+"</div>"),u.insertBefore(this)):u.append(n(MarkdownDeepEditorUI.ToolbarHtml())),n("a.mdd_button",u).click(MarkdownDeepEditorUI.onToolbarButton),n("a.mdd_help",u).click(MarkdownDeepEditorUI.onShowHelpPopup),MarkdownDeepEditorUI.HelpHtmlWritten||(s=n(MarkdownDeepEditorUI.HelpHtml(i.help_location)),s.appendTo(n("body")),n("#mdd_close_help").click(MarkdownDeepEditorUI.onCloseHelpPopup),MarkdownDeepEditorUI.HelpHtmlWritten=!0)),i.resizebar&&(r=n(this).next(".mdd_resizer"),r.length==0&&(r=n('<div class="mdd_resizer"></div>'),r.insertAfter(this)),r.bind("mousedown",MarkdownDeepEditorUI.onResizerMouseDown)),o=n(this).attr("data-mdd-preview"),o||(o=".mdd_preview"),e=n(o)[0],e||(n('<div class="mdd_preview"></div>').insertAfter(r?r:this),e=n(".mdd_preview")[0]),f=new MarkdownDeepEditor.Editor(this,e),t&&(jQuery.extend(f.Markdown,t),jQuery.extend(f,t)),f.onOptionsChanged(),n(this).data("mdd",f)})}})(jQuery)